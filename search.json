[{"path":"https://caravagnalab.github.io/devil/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2025 devil authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (‚ÄúSoftware‚Äù), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED ‚Äú‚Äù, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"loading-the-dataset","dir":"Articles","previous_headings":"","what":"Loading the dataset","title":"Using devil for complex designs with multiple covariates","text":"","code":"sce <- scRNAseq::RichardTCellData() #> downloading 1 resources #> retrieving 1 resource #> loading from cache #> require(\"ensembldb\") sce #> class: SingleCellExperiment  #> dim: 46603 572  #> metadata(0): #> assays(1): counts #> rownames(46603): ENSMUSG00000102693 ENSMUSG00000064842 ... #>   ENSMUSG00000096730 ENSMUSG00000095742 #> rowData names(0): #> colnames(572): SLX-12611.N701_S502. SLX-12611.N702_S502. ... #>   SLX-12612.i712_i522. SLX-12612.i714_i522. #> colData names(13): age individual ... stimulus time #> reducedDimNames(0): #> mainExpName: endogenous #> altExpNames(1): ERCC colnames(colData(sce)) #>  [1] \"age\"                        \"individual\"                 #>  [3] \"single cell well quality\"   \"post-analysis well quality\" #>  [5] \"single cell quality\"        \"CD69 measurement (log10)\"   #>  [7] \"CD25 measurement (log10)\"   \"CD44 measurement (log10)\"   #>  [9] \"CD62L measurement (log10)\"  \"sorting plate well\"         #> [11] \"sequencing plate well\"      \"stimulus\"                   #> [13] \"time\" head(as.data.frame(colData(sce))[, c(\"individual\", \"age\", \"stimulus\", \"time\", \"single.cell.quality\")]) #>                      individual age                                    stimulus #> SLX-12611.N701_S502.          1  25 OT-I reduced affinity peptide G4 (SIIGFEKL) #> SLX-12611.N702_S502.          1  25 OT-I reduced affinity peptide G4 (SIIGFEKL) #> SLX-12611.N703_S502.          1  25 OT-I reduced affinity peptide G4 (SIIGFEKL) #> SLX-12611.N704_S502.          1  25 OT-I reduced affinity peptide G4 (SIIGFEKL) #> SLX-12611.N705_S502.          1  25 OT-I reduced affinity peptide G4 (SIIGFEKL) #> SLX-12611.N706_S502.          1  25 OT-I reduced affinity peptide G4 (SIIGFEKL) #>                      time single.cell.quality #> SLX-12611.N701_S502.    6                  OK #> SLX-12611.N702_S502.    6                  OK #> SLX-12611.N703_S502.    6                  OK #> SLX-12611.N704_S502.    6                  OK #> SLX-12611.N705_S502.    6                  OK #> SLX-12611.N706_S502.    6                  OK"},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"basic-filtering","dir":"Articles","previous_headings":"","what":"Basic filtering","title":"Using devil for complex designs with multiple covariates","text":"keep cells flagged high quality light gene filtering speed. Filter genes low counts (optional): vignette, subsample devil runs quickly: now ‚Äôll work sce_sub.","code":"# Keep only good-quality cells sce <- sce[, sce$`single cell quality` == \"OK\"]  # Make sure key covariates are factors sce$individual <- factor(sce$individual) sce$age <- factor(sce$age) # e.g. \"young\"/\"old\" sce$stimulus <- droplevels(factor(sce$stimulus)) sce$time <- as.numeric(sce$time) sce$time_factor <- factor(sce$time, levels = sort(unique(sce$time)))  # Quick summary table(sce$stimulus, sce$time_factor) #>                                               #>                                                1  3  6 #>   OT-I high affinity peptide N4 (SIINFEKL)    51 64 91 #>   OT-I non-binding peptide NP68 (ASNENMDAM)    0  0 93 #>   OT-I reduced affinity peptide G4 (SIIGFEKL)  0  0 94 #>   OT-I reduced affinity peptide T4 (SIITFEKL)  0  0 91 #>   unstimulated                                 0  0  0 table(sce$age) #>  #> 11.5   25  #>  344  184 length(unique(sce$individual)) #> [1] 2 counts <- assay(sce, \"counts\") keep_genes <- Matrix::rowMeans(counts) > .1 & rowSums(counts > 0) > 100 sce <- sce[keep_genes, ] sce <- sce[, sce$stimulus != \"unstimulated\"] dim(sce) #> [1] 7267  484 set.seed(123) n_genes <- min(2000, nrow(sce)) n_cells <- min(3000, ncol(sce)) gene_idx <- sample(seq_len(nrow(sce)), n_genes) cell_idx <- sample(seq_len(ncol(sce)), n_cells) sce_sub <- sce[gene_idx, cell_idx] sce_sub #> class: SingleCellExperiment  #> dim: 2000 484  #> metadata(0): #> assays(1): counts #> rownames(2000): ENSMUSG00000038342 ENSMUSG00000060261 ... #>   ENSMUSG00000021076 ENSMUSG00000026005 #> rowData names(0): #> colnames(484): SLX-12611.N718_S515. SLX-12611.N721_S517. ... #>   SLX-12612.i723_i507. SLX-12612.i716_i513. #> colData names(14): age individual ... time time_factor #> reducedDimNames(0): #> mainExpName: endogenous #> altExpNames(1): ERCC"},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"building-a-complex-design-matrix","dir":"Articles","previous_headings":"","what":"Building a complex design matrix","title":"Using devil for complex designs with multiple covariates","text":"consider model : Main effects: stimulus (different T cell stimulation conditions), age Reference levels: first level factor baseline design matrix includes: (Intercept): Baseline expression level stimulus*: Effects different stimulation conditions relative reference age*: Effect age group","code":"meta_df <- as.data.frame(colData(sce_sub)) meta_df$stimulus <- droplevels(factor(meta_df$stimulus)) meta_df$time_factor <- factor(meta_df$time_factor) meta_df$age <- meta_df$age meta_df$individual <- factor(meta_df$individual)  design <- model.matrix(     ~ stimulus + age,     data = meta_df ) head(design) #>                      (Intercept) #> SLX-12611.N718_S515.           1 #> SLX-12611.N721_S517.           1 #> SLX-12611.N716_S516.           1 #> SLX-12612.i718_i503.           1 #> SLX-12612.i720_i513.           1 #> SLX-12612.i714_i505.           1 #>                      stimulusOT-I non-binding peptide NP68 (ASNENMDAM) #> SLX-12611.N718_S515.                                                 0 #> SLX-12611.N721_S517.                                                 0 #> SLX-12611.N716_S516.                                                 0 #> SLX-12612.i718_i503.                                                 0 #> SLX-12612.i720_i513.                                                 0 #> SLX-12612.i714_i505.                                                 0 #>                      stimulusOT-I reduced affinity peptide G4 (SIIGFEKL) #> SLX-12611.N718_S515.                                                   0 #> SLX-12611.N721_S517.                                                   1 #> SLX-12611.N716_S516.                                                   1 #> SLX-12612.i718_i503.                                                   0 #> SLX-12612.i720_i513.                                                   1 #> SLX-12612.i714_i505.                                                   1 #>                      stimulusOT-I reduced affinity peptide T4 (SIITFEKL) age25 #> SLX-12611.N718_S515.                                                   1     1 #> SLX-12611.N721_S517.                                                   0     1 #> SLX-12611.N716_S516.                                                   0     1 #> SLX-12612.i718_i503.                                                   0     0 #> SLX-12612.i720_i513.                                                   0     0 #> SLX-12612.i714_i505.                                                   0     0 colnames(design) #> [1] \"(Intercept)\"                                         #> [2] \"stimulusOT-I non-binding peptide NP68 (ASNENMDAM)\"   #> [3] \"stimulusOT-I reduced affinity peptide G4 (SIIGFEKL)\" #> [4] \"stimulusOT-I reduced affinity peptide T4 (SIITFEKL)\" #> [5] \"age25\""},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"fitting-the-devil-model","dir":"Articles","previous_headings":"","what":"Fitting the devil model","title":"Using devil for complex designs with multiple covariates","text":"Now, fit_devil() takes count matrix design matrix returns coefficients overdispersions.","code":"Y <- as.matrix(assay(sce_sub, \"counts\")) devil_fit <- devil::fit_devil(     input_matrix = Y,     design_matrix = design,     verbose = TRUE,     init_beta_rough = FALSE,     size_factors = \"normed_sum\",      overdispersion = \"MOM\" ) #> Compute size factors #> Calculating size factors using method: normed_sum #> Size factors calculated successfully. #> Range: [0.1449, 18.1165] #> Initialize theta #> Initialize beta #> Fitting beta coefficients #> Fit overdispersion (mode = MOM)"},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"interpreting-the-model-coefficients","dir":"Articles","previous_headings":"","what":"Interpreting the model coefficients","title":"Using devil for complex designs with multiple covariates","text":"fitted model contains coefficient estimates (log-scale) gene term design matrix.  Interpretation: Coefficients represent log-fold changes relative baseline (intercept) Large positive coefficients indicate upregulation Large negative coefficients indicate downregulation Coefficients near zero suggest little effect  Interpretation: Higher theta values indicate less overdispersion (Poisson-like), lower values indicate overdispersion (variability expected).","code":"# Extract coefficient matrix (genes x coefficients) beta_matrix <- devil_fit$beta dim(beta_matrix) #> [1] 2000    5 colnames(beta_matrix) = colnames(design)  # Look at coefficient distributions for a few terms coef_df <- as.data.frame(beta_matrix) %>%     mutate(gene = rownames(beta_matrix))  # Visualize coefficient distributions coef_long <- coef_df %>%     pivot_longer(cols = -gene, names_to = \"coefficient\", values_to = \"value\")  ggplot(coef_long %>% dplyr::filter(coefficient != \"(Intercept)\"),         aes(x = value, fill = coefficient)) +     geom_density(alpha = 0.5) +     facet_wrap(~coefficient, scales = \"free\") +     theme_bw() +     labs(title = \"Distribution of coefficient estimates across genes\",          x = \"Coefficient value (log scale)\",          y = \"Density\") +     theme(legend.position = \"none\") # Extract overdispersion parameters theta_vec <- devil_fit$overdispersion names(theta_vec) = rownames(Y) summary(theta_vec) #>     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.  #>  0.04054  1.31511  2.45837  3.66026  4.48420 75.12339  # Visualize overdispersion distribution data.frame(theta = theta_vec, gene = names(theta_vec)) %>%     ggplot(aes(x = theta)) +     geom_histogram(bins = 50, fill = \"steelblue\", alpha = 0.7) +     theme_bw() +     labs(title = \"Distribution of gene-wise overdispersion parameters\",          x = \"Theta (dispersion parameter)\",          y = \"Number of genes\") +     geom_vline(xintercept = median(theta_vec), linetype = \"dashed\", color = \"red\")"},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"differential-expression-testing","dir":"Articles","previous_headings":"","what":"Differential expression testing","title":"Using devil for complex designs with multiple covariates","text":"Now let‚Äôs test differential expression. ‚Äôll test specific hypotheses using Wald tests.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"testing-stimulus-effects","dir":"Articles","previous_headings":"Differential expression testing","what":"Testing stimulus effects","title":"Using devil for complex designs with multiple covariates","text":"Let‚Äôs identify genes differentially expressed response different stimuli:","code":"# For demonstration, we'll create a simplified test stimulus_coefs <- grep(\"^stimulus\", colnames(beta_matrix), value = TRUE)  # Test each stimulus coefficient de_results_list <- lapply(stimulus_coefs, function(coef) {     contrast_vector = as.numeric(colnames(beta_matrix) == coef)        # Simple approach: test if coefficient significantly different from 0     de_res = devil::test_de(devil_fit, contrast = contrast_vector, clusters = meta_df$individual, max_lfc = 100)     de_res %>% dplyr::mutate(coefficient = coef) }) #> Converting clusters to numeric factors #> Converting clusters to numeric factors #> Converting clusters to numeric factors  de_results <- bind_rows(de_results_list)  # Summary of DE genes per stimulus de_summary <- de_results %>%     group_by(coefficient) %>%     summarise(         n_de = sum(adj_pval < 0.05),         n_up = sum(adj_pval < 0.05 & lfc > 0),         n_down = sum(adj_pval < 0.05 & lfc < 0),         .groups = \"drop\"     )  print(de_summary) #> # A tibble: 3 √ó 4 #>   coefficient                                          n_de  n_up n_down #>   <chr>                                               <int> <int>  <int> #> 1 stimulusOT-I non-binding peptide NP68 (ASNENMDAM)     533   261    272 #> 2 stimulusOT-I reduced affinity peptide G4 (SIIGFEKL)   139    70     69 #> 3 stimulusOT-I reduced affinity peptide T4 (SIITFEKL)    19     9     10"},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"volcano-plots","dir":"Articles","previous_headings":"Differential expression testing","what":"Volcano plots","title":"Using devil for complex designs with multiple covariates","text":"Visualize differential expression results:","code":"# Create volcano plot for each stimulus de_results %>%     mutate(         de_status = case_when(             adj_pval < 0.05 & lfc > 0.5 ~ \"Up\",             adj_pval < 0.05 & lfc < -0.5 ~ \"Down\",             TRUE ~ \"Not DE\"         )     ) %>%     ggplot(aes(x = lfc, y = -log10(adj_pval), color = de_status)) +     geom_point(alpha = 0.6, size = 1.5) +     facet_wrap(~coefficient, scales = \"free\") +     scale_color_manual(values = c(\"Up\" = \"red\", \"Down\" = \"blue\", \"Not DE\" = \"gray\")) +     theme_bw() +     labs(title = \"Volcano plots for stimulus effects\",          x = \"Log fold change\",          y = \"-log10(p-value)\",          color = \"DE status\") +     geom_hline(yintercept = -log10(0.05), linetype = \"dashed\", alpha = 0.5) +     geom_vline(xintercept = c(-0.5, 0.5), linetype = \"dashed\", alpha = 0.5)"},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"top-differentially-expressed-genes","dir":"Articles","previous_headings":"Differential expression testing","what":"Top differentially expressed genes","title":"Using devil for complex designs with multiple covariates","text":"","code":"# Extract top DE genes for each stimulus top_genes <- de_results %>%     dplyr::filter(adj_pval < 0.05) %>%     dplyr::group_by(coefficient) %>%     dplyr::arrange(adj_pval) %>%     dplyr::slice_head(n = 10) %>%     dplyr::select(coefficient, name, lfc, adj_pval)  print(top_genes) #> # A tibble: 30 √ó 4 #> # Groups:   coefficient [3] #>    coefficient                                       name           lfc adj_pval #>    <chr>                                             <chr>        <dbl>    <dbl> #>  1 stimulusOT-I non-binding peptide NP68 (ASNENMDAM) ENSMUSG0000‚Ä¶ -1.72 6.55e-39 #>  2 stimulusOT-I non-binding peptide NP68 (ASNENMDAM) ENSMUSG0000‚Ä¶  2.47 7.58e-36 #>  3 stimulusOT-I non-binding peptide NP68 (ASNENMDAM) ENSMUSG0000‚Ä¶ -2.17 1.63e-21 #>  4 stimulusOT-I non-binding peptide NP68 (ASNENMDAM) ENSMUSG0000‚Ä¶ -1.87 2.74e-20 #>  5 stimulusOT-I non-binding peptide NP68 (ASNENMDAM) ENSMUSG0000‚Ä¶  1.73 1.12e-19 #>  6 stimulusOT-I non-binding peptide NP68 (ASNENMDAM) ENSMUSG0000‚Ä¶ -6.27 2.45e-19 #>  7 stimulusOT-I non-binding peptide NP68 (ASNENMDAM) ENSMUSG0000‚Ä¶ -4.06 2.97e-17 #>  8 stimulusOT-I non-binding peptide NP68 (ASNENMDAM) ENSMUSG0000‚Ä¶  1.96 1.41e-16 #>  9 stimulusOT-I non-binding peptide NP68 (ASNENMDAM) ENSMUSG0000‚Ä¶ -4.56 4.68e-16 #> 10 stimulusOT-I non-binding peptide NP68 (ASNENMDAM) ENSMUSG0000‚Ä¶  2.56 3.41e-15 #> # ‚Ñπ 20 more rows"},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"heatmap-of-top-de-genes","dir":"Articles","previous_headings":"Differential expression testing","what":"Heatmap of top DE genes","title":"Using devil for complex designs with multiple covariates","text":"","code":"# Get top 20 most variable DE genes top_de_genes <- de_results %>%     dplyr::filter(adj_pval < 0.05) %>%     dplyr::group_by(name) %>%     dplyr::summarise(max_abs_lfc = max(abs(lfc)), .groups = \"drop\") %>%     dplyr::arrange(desc(max_abs_lfc)) %>%     dplyr::slice_head(n = 20) %>%     dplyr::pull(name)  if (length(top_de_genes) > 0) {     # Extract coefficients for top genes     top_coef_matrix <- beta_matrix[top_de_genes, stimulus_coefs, drop = FALSE]          # Create heatmap     pheatmap::pheatmap(         top_coef_matrix,         scale = \"row\",         cluster_cols = FALSE,         main = \"Top DE genes across stimuli\",         fontsize = 8     ) }"},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"testing-age-effects","dir":"Articles","previous_headings":"","what":"Testing age effects","title":"Using devil for complex designs with multiple covariates","text":"","code":"# Test for age effect if present in model age_coefs <- grep(\"^age\", colnames(beta_matrix), value = TRUE)  if (length(age_coefs) > 0) {     contrast_vector = as.numeric(colnames(beta_matrix) == age_coefs)     age_de <- devil::test_de(devil_fit, contrast = contrast_vector, clusters = meta_df$individual)          print(paste(\"Number of age-associated DE genes (FDR < 0.05):\", sum(age_de$adj_pval < 0.05)))          # Show top age-associated genes     print(head(age_de)) } #> Converting clusters to numeric factors #> [1] \"Number of age-associated DE genes (FDR < 0.05): 466\" #> # A tibble: 6 √ó 4 #>   name                  pval adj_pval    lfc #>   <chr>                <dbl>    <dbl>  <dbl> #> 1 ENSMUSG00000038342 0.146     0.313   0.320 #> 2 ENSMUSG00000060261 0.126     0.284  -0.298 #> 3 ENSMUSG00000029198 0.00268   0.0159  0.608 #> 4 ENSMUSG00000082951 0.00730   0.0356  0.493 #> 5 ENSMUSG00000022204 0.0935    0.232  -0.316 #> 6 ENSMUSG00000063802 0.0423    0.130   0.403"},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"mean-variance-relationship","dir":"Articles","previous_headings":"","what":"Mean-variance relationship","title":"Using devil for complex designs with multiple covariates","text":"Let‚Äôs also plot mean-variance relationship, see far model simple Poisson","code":"# Mean-variance relationship gene_means <- rowMeans(Y) gene_vars <- apply(Y, 1, var)  plot_df <- data.frame(     mean = gene_means,     variance = gene_vars,     theta = theta_vec )  ggplot(plot_df, aes(x = log10(mean + 1), y = log10(variance + 1))) +     geom_point(aes(color = log10(theta)), alpha = 0.5) +     geom_abline(slope = 1, intercept = 0, linetype = \"dashed\", color = \"red\") +     scale_color_viridis_c() +     theme_bw() +     labs(title = \"Mean-variance relationship\",          x = \"log10(mean count + 1)\",          y = \"log10(variance + 1)\",          color = \"log10(theta)\") +     annotate(\"text\", x = Inf, y = -Inf,               label = \"Dashed line = Poisson expectation\",              hjust = 1.1, vjust = -0.5, size = 3, color = \"red\")"},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"summary","dir":"Articles","previous_headings":"","what":"Summary","title":"Using devil for complex designs with multiple covariates","text":"vignette demonstrated: Model fitting complex designs including multiple factors Coefficient interpretation showing extract visualize effect sizes Differential expression testing using Wald tests model coefficients Result visualization volcano plots heatmaps Model diagnostics assess fit quality devil package provides flexible framework modeling single-cell count data complex experimental designs, enabling rigorous differential expression analysis accounting overdispersion.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/DE_with_multiple_features.html","id":"session-info","dir":"Articles","previous_headings":"","what":"Session Info","title":"Using devil for complex designs with multiple covariates","text":"","code":"sessionInfo() #> R version 4.5.2 (2025-10-31) #> Platform: x86_64-pc-linux-gnu #> Running under: Ubuntu 24.04.3 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0 #>  #> locale: #>  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8        #>  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8    #>  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C           #> [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C    #>  #> time zone: UTC #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] ensembldb_2.34.0            AnnotationFilter_1.34.0     #>  [3] GenomicFeatures_1.62.0      AnnotationDbi_1.72.0        #>  [5] tidyr_1.3.2                 ggplot2_4.0.1               #>  [7] dplyr_1.1.4                 Matrix_1.7-4                #>  [9] scRNAseq_2.24.0             SingleCellExperiment_1.32.0 #> [11] SummarizedExperiment_1.40.0 Biobase_2.70.0              #> [13] GenomicRanges_1.62.1        Seqinfo_1.0.0               #> [15] IRanges_2.44.0              S4Vectors_0.48.0            #> [17] BiocGenerics_0.56.0         generics_0.1.4              #> [19] MatrixGenerics_1.22.0       matrixStats_1.5.0           #> [21] devil_0.99.0                #>  #> loaded via a namespace (and not attached): #>   [1] DBI_1.2.3                 bitops_1.0-9              #>   [3] httr2_1.2.2               rlang_1.1.6               #>   [5] magrittr_2.0.4            gypsum_1.6.0              #>   [7] compiler_4.5.2            RSQLite_2.4.5             #>   [9] DelayedMatrixStats_1.32.0 png_0.1-8                 #>  [11] systemfonts_1.3.1         vctrs_0.6.5               #>  [13] ProtGenerics_1.42.0       pkgconfig_2.0.3           #>  [15] crayon_1.5.3              fastmap_1.2.0             #>  [17] dbplyr_2.5.1              XVector_0.50.0            #>  [19] labeling_0.4.3            utf8_1.2.6                #>  [21] Rsamtools_2.26.0          rmarkdown_2.30            #>  [23] UCSC.utils_1.6.1          ragg_1.5.0                #>  [25] purrr_1.2.0               bit_4.6.0                 #>  [27] xfun_0.55                 cachem_1.1.0              #>  [29] cigarillo_1.0.0           GenomeInfoDb_1.46.2       #>  [31] jsonlite_2.0.0            blob_1.2.4                #>  [33] rhdf5filters_1.22.0       DelayedArray_0.36.0       #>  [35] Rhdf5lib_1.32.0           BiocParallel_1.44.0       #>  [37] parallel_4.5.2            R6_2.6.1                  #>  [39] RColorBrewer_1.1-3        bslib_0.9.0               #>  [41] rtracklayer_1.70.1        jquerylib_0.1.4           #>  [43] Rcpp_1.1.0                knitr_1.51                #>  [45] tidyselect_1.2.1          abind_1.4-8               #>  [47] yaml_2.3.12               codetools_0.2-20          #>  [49] curl_7.0.0                lattice_0.22-7            #>  [51] alabaster.sce_1.10.0      tibble_3.3.0              #>  [53] withr_3.0.2               S7_0.2.1                  #>  [55] KEGGREST_1.50.0           evaluate_1.0.5            #>  [57] desc_1.4.3                BiocFileCache_3.0.0       #>  [59] alabaster.schemas_1.10.0  ExperimentHub_3.0.0       #>  [61] Biostrings_2.78.0         pillar_1.11.1             #>  [63] BiocManager_1.30.27       filelock_1.0.3            #>  [65] RCurl_1.98-1.17           BiocVersion_3.22.0        #>  [67] sparseMatrixStats_1.22.0  scales_1.4.0              #>  [69] alabaster.base_1.10.0     glue_1.8.0                #>  [71] alabaster.ranges_1.10.0   pheatmap_1.0.13           #>  [73] alabaster.matrix_1.10.0   lazyeval_0.2.2            #>  [75] tools_4.5.2               AnnotationHub_4.0.0       #>  [77] BiocIO_1.20.0             GenomicAlignments_1.46.0  #>  [79] fs_1.6.6                  XML_3.99-0.20             #>  [81] rhdf5_2.54.1              grid_4.5.2                #>  [83] HDF5Array_1.38.0          restfulr_0.0.16           #>  [85] cli_3.6.5                 rappdirs_0.3.3            #>  [87] textshaping_1.0.4         viridisLite_0.4.2         #>  [89] S4Arrays_1.10.1           gtable_0.3.6              #>  [91] alabaster.se_1.10.0       sass_0.4.10               #>  [93] digest_0.6.39             SparseArray_1.10.8        #>  [95] farver_2.1.2              rjson_0.2.23              #>  [97] memoise_2.0.1             htmltools_0.5.9           #>  [99] pkgdown_2.2.0             lifecycle_1.0.4           #> [101] h5mread_1.2.1             httr_1.4.7                #> [103] bit64_4.6.0-1"},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Using devil for continuous variables","text":"vignette demonstrates use devil package perform differential expression (DE) analysis continuous covariates. Specifically, ‚Äôll analyze gene expression changes time experiment continuous variable days post-amputation.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"setup-and-data-loading","dir":"Articles","previous_headings":"","what":"Setup and Data Loading","title":"Using devil for continuous variables","text":"","code":"library(devil) library(scRNAseq) library(SingleCellExperiment) library(Matrix) library(dplyr) library(ggplot2) library(tidyr) library(ggpubr)  # Load axolotl tail regeneration data # This dataset contains scRNA-seq from regenerating tail tissue at different timepoints sce <- scRNAseq::AztekinTailData()"},{"path":[]},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"quality-filtering","dir":"Articles","previous_headings":"Data Preprocessing","what":"Quality Filtering","title":"Using devil for continuous variables","text":"first filter genes low expression remove noise improve computational efficiency:","code":"counts <- assay(sce, \"counts\")  # Keep genes with: # 1. Mean expression > 0.1 counts per cell # 2. Detected in at least 100 cells keep_genes <- rowMeans(counts) > 0.1 & rowSums(counts > 0) > 100 sce <- sce[keep_genes, ]  cat(\"After filtering:\", nrow(sce), \"genes and\", ncol(sce), \"cells\\n\") #> After filtering: 7779 genes and 13199 cells"},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"subsampling-for-quick-demonstration","dir":"Articles","previous_headings":"Data Preprocessing","what":"Subsampling for Quick Demonstration","title":"Using devil for continuous variables","text":"vignette, subsample data computations run quickly. practice, use full filtered dataset:","code":"set.seed(123) n_genes <- min(2000, nrow(sce)) n_cells <- min(5000, ncol(sce))  gene_idx <- sample(seq_len(nrow(sce)), n_genes) cell_idx <- sample(seq_len(ncol(sce)), n_cells) sce_sub <- sce[gene_idx, cell_idx]  cat(\"Working with:\", nrow(sce_sub), \"genes and\", ncol(sce_sub), \"cells\\n\") #> Working with: 2000 genes and 5000 cells"},{"path":[]},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"understanding-the-covariate","dir":"Articles","previous_headings":"Building the Design Matrix","what":"Understanding the Covariate","title":"Using devil for continuous variables","text":"main variable interest DaysPostAmputation, continuous variable representing time since amputation. Let‚Äôs examine distribution:","code":"meta_df <- as.data.frame(colData(sce_sub))  # Check the range and distribution of DaysPostAmputation cat(\"DaysPostAmputation range:\",      min(meta_df$DaysPostAmputation), \"to\",      max(meta_df$DaysPostAmputation), \"days\\n\") #> DaysPostAmputation range: 0 to 3 days  table(meta_df$DaysPostAmputation) #>  #>    0    1    2    3  #> 2004 1175  875  946"},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"creating-the-design-matrix","dir":"Articles","previous_headings":"Building the Design Matrix","what":"Creating the Design Matrix","title":"Using devil for continuous variables","text":"continuous covariate, design matrix includes: 1. intercept term representing baseline expression 2. slope term DaysPostAmputation representing rate change per day Interpretation: - (Intercept): Expected log-expression day 0 - DaysPostAmputation: Change log-expression per additional day (.e., slope)","code":"design <- model.matrix(   ~ DaysPostAmputation,   data = meta_df )  head(design, n = 10) #>                    (Intercept) DaysPostAmputation #> GCATACACAGCCAATT.1           1                  2 #> ATAGACCAGTGCGATG.1           1                  0 #> ATTACTCGTCTTCTCG.1           1                  1 #> GGACAAGAGAGGGCTT.1           1                  2 #> GATGCTACAGAGTGTG.1           1                  0 #> CTCTAATTCAAACAAG.1           1                  0 #> ACGTCAACAACACCTA.1           1                  3 #> TGTGGTATCTCTAGGA.1           1                  0 #> TCAGCTCCACAGGCCT.1           1                  0 #> GTCCTCAAGCGATGAC.1           1                  3 cat(\"\\nDesign matrix columns:\", colnames(design), \"\\n\") #>  #> Design matrix columns: (Intercept) DaysPostAmputation cat(\"Design matrix dimensions:\", nrow(design), \"cells √ó\", ncol(design), \"coefficients\\n\") #> Design matrix dimensions: 5000 cells √ó 2 coefficients"},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"fitting-the-devil-model","dir":"Articles","previous_headings":"","what":"Fitting the devil model","title":"Using devil for continuous variables","text":"Now, fit_devil() takes count matrix design matrix returns coefficients overdispersions.","code":"Y <- as.matrix(assay(sce_sub, \"counts\"))  devil_fit <- devil::fit_devil(   input_matrix = Y,   design_matrix = design,   verbose = TRUE,   init_beta_rough = FALSE,   size_factors = \"normed_sum\",    overdispersion = \"MOM\" ) #> Compute size factors #> Calculating size factors using method: normed_sum #> Size factors calculated successfully. #> Range: [0.1246, 9.1512] #> Initialize theta #> Initialize beta #> Fitting beta coefficients #> Fit overdispersion (mode = MOM)"},{"path":[]},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"coefficient-matrix-structure","dir":"Articles","previous_headings":"Interpreting Model Coefficients","what":"Coefficient Matrix Structure","title":"Using devil for continuous variables","text":"fitted model contains coefficient estimates (log scale) gene term design matrix:","code":"beta_matrix <- devil_fit$beta dim(beta_matrix) #> [1] 2000    2 colnames(beta_matrix) <- colnames(design)  cat(\"\\nCoefficient matrix: \", nrow(beta_matrix), \"genes √ó\",      ncol(beta_matrix), \"coefficients\\n\") #>  #> Coefficient matrix:  2000 genes √ó 2 coefficients"},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"visualizing-coefficient-distributions","dir":"Articles","previous_headings":"Interpreting Model Coefficients","what":"Visualizing Coefficient Distributions","title":"Using devil for continuous variables","text":"Let‚Äôs examine distribution DaysPostAmputation coefficient across genes:  Interpretation: Genes positive coefficients increase expression time Genes negative coefficients decrease expression time magnitude indicates rate change per day","code":"coef_df <- as.data.frame(beta_matrix) %>%   dplyr::mutate(gene = rownames(beta_matrix))  # Reshape for plotting coef_long <- coef_df %>%   tidyr::pivot_longer(cols = -gene, names_to = \"coefficient\", values_to = \"value\")  # Plot distribution of DaysPostAmputation coefficient ggplot(coef_long %>% dplyr::filter(coefficient == \"DaysPostAmputation\"), aes(x = value)) +   geom_histogram(bins = 50, fill = \"steelblue\", alpha = 0.7) +   geom_vline(xintercept = 0, linetype = \"dashed\", color = \"red\", linewidth = 1) +   theme_bw() +   labs(     title = \"Distribution of DaysPostAmputation coefficients across genes\",     subtitle = \"Positive values = upregulated over time, Negative = downregulated\",     x = \"Coefficient value (log fold-change per day)\",     y = \"Number of genes\"   )"},{"path":[]},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"testing-for-time-dependent-expression","dir":"Articles","previous_headings":"Differential Expression Testing","what":"Testing for Time-Dependent Expression","title":"Using devil for continuous variables","text":"use Wald test identify genes whose expression significantly changes days post-amputation. contrast vector c(0, 1) tests DaysPostAmputation coefficient (second column design matrix):","code":"# Contrast vector: test the DaysPostAmputation coefficient # c(Intercept, DaysPostAmputation) contrast_vector <- c(0, 1)  de_res <- devil::test_de(   devil_fit,    contrast = contrast_vector,    clusters = meta_df$sample,  # Account for sample-level correlation   max_lfc = 100 ) #> Converting clusters to numeric factors  # Add gene names de_res$name <- rownames(beta_matrix)  head(de_res) #> # A tibble: 6 √ó 4 #>   name       pval adj_pval      lfc #>   <chr>     <dbl>    <dbl>    <dbl> #> 1 timm10b.S 0.633    0.961 -0.104   #> 2 nudcd2.L  0.519    0.934 -0.123   #> 3 srsf4.S   0.211    0.855 -0.100   #> 4 tmem144.L 0.397    0.929  0.173   #> 5 c1d.L     0.766    0.973  0.0523  #> 6 pop7.L    0.980    0.998 -0.00219"},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"summary-of-de-results","dir":"Articles","previous_headings":"Differential Expression Testing","what":"Summary of DE Results","title":"Using devil for continuous variables","text":"","code":"# Count significant genes at FDR < 0.05 de_summary <- de_res %>%   summarise(     total_genes = n(),     n_de = sum(adj_pval < 0.05),     n_upregulated = sum(adj_pval < 0.05 & lfc > 0),     n_downregulated = sum(adj_pval < 0.05 & lfc < 0),     pct_de = round(100 * n_de / total_genes, 1)   )  print(de_summary) #> # A tibble: 1 √ó 5 #>   total_genes  n_de n_upregulated n_downregulated pct_de #>         <int> <int>         <int>           <int>  <dbl> #> 1        2000    20            10              10      1  cat(\"\\n\", de_summary$n_upregulated, \"genes increase expression over time\\n\") #>  #>  10 genes increase expression over time cat(de_summary$n_downregulated, \"genes decrease expression over time\\n\") #> 10 genes decrease expression over time"},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"volcano-plot","dir":"Articles","previous_headings":"Differential Expression Testing","what":"Volcano Plot","title":"Using devil for continuous variables","text":"Visualize relationship effect size (log fold-change per day) significance:","code":"devil:::plot_volcano(devil.res = de_res) +    labs(     title = \"Volcano plot: Time-dependent gene expression\",     x = \"Log fold-change per day\",     y = \"-log10(Adjusted p-value)\"   )"},{"path":[]},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"identify-top-genes","dir":"Articles","previous_headings":"Visualizing Top DE Genes","what":"Identify Top Genes","title":"Using devil for continuous variables","text":"Select 10 genes strongest time-dependent effects:","code":"top_genes <- de_res %>%   dplyr::filter(adj_pval <= 0.05) %>%   dplyr::arrange(desc(abs(lfc))) %>%   dplyr::slice_head(n = 10) %>%   dplyr::pull(name)  cat(\"Top 10 time-responsive genes:\\n\") #> Top 10 time-responsive genes: print(top_genes) #>  [1] \"loc549413.S\"       \"Xelaev18045082m.g\" \"loc100486088.L\"    #>  [4] \"hes5_X2.L\"         \"Xetrov90029035m.L\" \"hes5.1.S\"          #>  [7] \"Xelaev18007618m.g\" \"loc100492943.L\"    \"hoxa13.L\"          #> [10] \"Xelaev18025819m.g\"  # Show their statistics de_res %>%   dplyr::filter(name %in% top_genes) %>%   dplyr::select(name, lfc, pval, adj_pval) %>%   dplyr::arrange(desc(abs(lfc))) %>%   print() #> # A tibble: 10 √ó 4 #>    name                 lfc        pval adj_pval #>    <chr>              <dbl>       <dbl>    <dbl> #>  1 loc549413.S       -1.90  0.0000106   0.00425  #>  2 Xelaev18045082m.g -1.59  0.000133    0.0205   #>  3 loc100486088.L     1.41  0.000000909 0.000909 #>  4 hes5_X2.L         -1.22  0.0000333   0.00824  #>  5 Xetrov90029035m.L -1.20  0.000157    0.0224   #>  6 hes5.1.S          -1.05  0.000000240 0.000480 #>  7 Xelaev18007618m.g  0.996 0.0000822   0.0149   #>  8 loc100492943.L     0.948 0.00000765  0.00383  #>  9 hoxa13.L          -0.931 0.0000281   0.00824  #> 10 Xelaev18025819m.g  0.914 0.000448    0.0448"},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"expression-trajectories-over-time","dir":"Articles","previous_headings":"Visualizing Top DE Genes","what":"Expression Trajectories Over Time","title":"Using devil for continuous variables","text":"Create scatter plots showing expression changes days post-amputation top genes:","code":"counts <- assay(sce_sub, \"counts\")  # Function to plot gene expression vs. DaysPostAmputation plot_gene_trajectory <- function(gene_name) {   stopifnot(gene_name %in% rownames(counts))      # Get gene info   gene_info <- de_res %>% dplyr::filter(name == gene_name)      df <- tibble(     DaysPostAmputation = as.numeric(as.character(sce_sub$DaysPostAmputation)),     expr = as.numeric(counts[gene_name, ])   )      # Create plot   p <- ggplot(df, aes(x = DaysPostAmputation, y = log1p(expr))) +     geom_point(       alpha = 0.3,        size = 1.5,        position = position_jitter(width = 0.08, height = 0),       color = \"gray40\"     ) +     stat_summary(       fun = mean,       geom = \"point\",       size = 2.8,       color = \"red\"     ) +     theme_bw() +     labs(       title = gene_name,       subtitle = sprintf(         \"LFC/day = %.3f, adj. p = %.2e\",         gene_info$lfc,         gene_info$adj_pval       ),       x = \"Days post amputation\",       y = \"log1p(Counts)\"     ) +     theme(plot.subtitle = element_text(size = 9))      return(p) }"},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"plot-top-upregulated-and-downregulated-genes","dir":"Articles","previous_headings":"Visualizing Top DE Genes","what":"Plot Top Upregulated and Downregulated Genes","title":"Using devil for continuous variables","text":"Interpretation: point represents single cell red point indicates mean expression given day","code":"# Get top upregulated and downregulated genes top_up <- de_res %>%   dplyr::filter(adj_pval < 0.05, lfc > 0) %>%   dplyr::arrange(desc(lfc)) %>%   dplyr::slice_head(n = 2) %>%   dplyr::pull(name)  top_down <- de_res %>%   dplyr::filter(adj_pval < 0.05, lfc < 0) %>%   dplyr::arrange(lfc) %>%   dplyr::slice_head(n = 2) %>%   dplyr::pull(name)  # Create plots plots <- lapply(c(top_up, top_down), plot_gene_trajectory)  # Arrange plots ggpubr::ggarrange(   plotlist = plots,   ncol = 2,   nrow = 2,   align = \"hv\" )"},{"path":"https://caravagnalab.github.io/devil/articles/continuousCov.html","id":"summary","dir":"Articles","previous_headings":"","what":"Summary","title":"Using devil for continuous variables","text":"vignette demonstrated: Data preparation: Filtering structuring single-cell RNA-seq data Design matrix: Creating model continuous covariates Model fitting: Using fit_devil() estimate gene-specific parameters Hypothesis testing: Identifying genes significant time-dependent expression Visualization: Interpreting results volcano plots expression trajectories","code":"sessionInfo() #> R version 4.5.2 (2025-10-31) #> Platform: x86_64-pc-linux-gnu #> Running under: Ubuntu 24.04.3 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0 #>  #> locale: #>  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8        #>  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8    #>  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C           #> [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C    #>  #> time zone: UTC #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] ggpubr_0.6.2                tidyr_1.3.2                 #>  [3] ggplot2_4.0.1               dplyr_1.1.4                 #>  [5] Matrix_1.7-4                scRNAseq_2.24.0             #>  [7] SingleCellExperiment_1.32.0 SummarizedExperiment_1.40.0 #>  [9] Biobase_2.70.0              GenomicRanges_1.62.1        #> [11] Seqinfo_1.0.0               IRanges_2.44.0              #> [13] S4Vectors_0.48.0            BiocGenerics_0.56.0         #> [15] generics_0.1.4              MatrixGenerics_1.22.0       #> [17] matrixStats_1.5.0           devil_0.99.0                #>  #> loaded via a namespace (and not attached): #>   [1] RColorBrewer_1.1-3        jsonlite_2.0.0            #>   [3] magrittr_2.0.4            GenomicFeatures_1.62.0    #>   [5] gypsum_1.6.0              farver_2.1.2              #>   [7] rmarkdown_2.30            fs_1.6.6                  #>   [9] BiocIO_1.20.0             ragg_1.5.0                #>  [11] vctrs_0.6.5               memoise_2.0.1             #>  [13] Rsamtools_2.26.0          DelayedMatrixStats_1.32.0 #>  [15] RCurl_1.98-1.17           rstatix_0.7.3             #>  [17] htmltools_0.5.9           S4Arrays_1.10.1           #>  [19] AnnotationHub_4.0.0       curl_7.0.0                #>  [21] broom_1.0.11              Rhdf5lib_1.32.0           #>  [23] SparseArray_1.10.8        Formula_1.2-5             #>  [25] rhdf5_2.54.1              sass_0.4.10               #>  [27] alabaster.base_1.10.0     bslib_0.9.0               #>  [29] desc_1.4.3                alabaster.sce_1.10.0      #>  [31] httr2_1.2.2               cachem_1.1.0              #>  [33] GenomicAlignments_1.46.0  lifecycle_1.0.4           #>  [35] pkgconfig_2.0.3           R6_2.6.1                  #>  [37] fastmap_1.2.0             digest_0.6.39             #>  [39] AnnotationDbi_1.72.0      ExperimentHub_3.0.0       #>  [41] textshaping_1.0.4         RSQLite_2.4.5             #>  [43] filelock_1.0.3            labeling_0.4.3            #>  [45] httr_1.4.7                abind_1.4-8               #>  [47] compiler_4.5.2            bit64_4.6.0-1             #>  [49] withr_3.0.2               S7_0.2.1                  #>  [51] backports_1.5.0           BiocParallel_1.44.0       #>  [53] carData_3.0-5             DBI_1.2.3                 #>  [55] HDF5Array_1.38.0          alabaster.ranges_1.10.0   #>  [57] alabaster.schemas_1.10.0  ggsignif_0.6.4            #>  [59] rappdirs_0.3.3            DelayedArray_0.36.0       #>  [61] rjson_0.2.23              tools_4.5.2               #>  [63] glue_1.8.0                h5mread_1.2.1             #>  [65] restfulr_0.0.16           rhdf5filters_1.22.0       #>  [67] grid_4.5.2                gtable_0.3.6              #>  [69] ensembldb_2.34.0          utf8_1.2.6                #>  [71] car_3.1-3                 XVector_0.50.0            #>  [73] BiocVersion_3.22.0        pillar_1.11.1             #>  [75] BiocFileCache_3.0.0       lattice_0.22-7            #>  [77] rtracklayer_1.70.1        bit_4.6.0                 #>  [79] tidyselect_1.2.1          Biostrings_2.78.0         #>  [81] knitr_1.51                ProtGenerics_1.42.0       #>  [83] xfun_0.55                 UCSC.utils_1.6.1          #>  [85] lazyeval_0.2.2            yaml_2.3.12               #>  [87] evaluate_1.0.5            codetools_0.2-20          #>  [89] cigarillo_1.0.0           tibble_3.3.0              #>  [91] alabaster.matrix_1.10.0   BiocManager_1.30.27       #>  [93] cli_3.6.5                 systemfonts_1.3.1         #>  [95] jquerylib_0.1.4           Rcpp_1.1.0                #>  [97] GenomeInfoDb_1.46.2       dbplyr_2.5.1              #>  [99] png_0.1-8                 XML_3.99-0.20             #> [101] parallel_4.5.2            pkgdown_2.2.0             #> [103] blob_1.2.4                AnnotationFilter_1.34.0   #> [105] sparseMatrixStats_1.22.0  bitops_1.0-9              #> [107] alabaster.se_1.10.0       scales_1.4.0              #> [109] purrr_1.2.0               crayon_1.5.3              #> [111] rlang_1.1.6               cowplot_1.2.0             #> [113] KEGGREST_1.50.0"},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"devil statistical model, CPU and GPU implementation","text":"devil package implements negative binomial regression count data, particularly designed single-cell RNA-seq analysis. vignette explains: statistical model fitting procedure Shared computational steps (CPU GPU) CPU implementation practical examples GPU implementation (conceptual overview) use CPU vs GPU Performance optimization strategies","code":""},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"the-statistical-model","dir":"Articles","previous_headings":"Introduction","what":"The Statistical Model","title":"devil statistical model, CPU and GPU implementation","text":"Devil fits negative binomial generalized linear model gene: Yij‚àºNB(Œºij,Œ∏i) Y_{ij} \\sim \\text{NB}(\\mu_{ij}, \\theta_i) : YijY_{ij} count gene ii cell jj Œºij=sjexp(ùêójTùõÉi)\\mu_{ij} = s_j \\exp(\\mathbf{X}_j^T \\boldsymbol{\\beta}_i) expected count sjs_j size factor cell jj (normalization) ùêój\\mathbf{X}_j design matrix row cell jj (covariates) ùõÉi\\boldsymbol{\\beta}_i coefficient vector gene ii Œ∏i\\theta_i overdispersion parameter gene ii model accounts : Technical variation via size factors Biological covariates via design matrix Overdispersion beyond Poisson variation","code":""},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"common-steps-cpu-and-gpu","dir":"Articles","previous_headings":"","what":"Common Steps (CPU and GPU)","title":"devil statistical model, CPU and GPU implementation","text":"implementations share following preprocessing steps:","code":""},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"size-factor-calculation","dir":"Articles","previous_headings":"Common Steps (CPU and GPU)","what":"1. Size Factor Calculation","title":"devil statistical model, CPU and GPU implementation","text":"Size factors normalize differences sequencing depth across cells.","code":"# Simulate example data set.seed(123) n_genes <- 500 n_cells <- 200 counts <- matrix(     rnbinom(n_genes * n_cells, mu = 20, size = 5),     nrow = n_genes, ncol = n_cells ) rownames(counts) <- paste0(\"Gene\", seq_len(n_genes)) colnames(counts) <- paste0(\"Cell\", seq_len(n_cells))  # Create design matrix (two groups) group <- factor(rep(c(\"Control\", \"Treatment\"), each = n_cells/2)) design <- model.matrix(~ group)"},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"available-normalization-methods","dir":"Articles","previous_headings":"Common Steps (CPU and GPU) > 1. Size Factor Calculation","what":"Available normalization methods:","title":"devil statistical model, CPU and GPU implementation","text":"Interpretation: normed_sum: Fast, works datasets psinorm: robust many genes highly variable NULL: Use data already normalized","code":"# Method 1: Geometric mean normalization (default, fast) fit_normed <- fit_devil(     input_matrix = counts,     design_matrix = design,     size_factors = \"normed_sum\",     verbose = FALSE )  # Method 2: Psi-normalization (robust to highly variable genes) fit_psi <- fit_devil(     input_matrix = counts,     design_matrix = design,     size_factors = \"psinorm\",     verbose = FALSE )  # Method 3: No normalization (all size factors = 1) fit_no_norm <- fit_devil(     input_matrix = counts,     design_matrix = design,     size_factors = NULL,     verbose = FALSE )  # Compare size factors sf_comparison <- data.frame(     cell = seq_len(n_cells),     normed_sum = fit_normed$size_factors,     psinorm = fit_psi$size_factors,     no_norm = fit_no_norm$size_factors )  sf_comparison %>%     pivot_longer(-cell, names_to = \"method\", values_to = \"size_factor\") %>%     ggplot(aes(x = cell, y = size_factor, color = method)) +     geom_line() +     theme_bw() +     labs(title = \"Size factors across normalization methods\",          x = \"Cell index\", y = \"Size factor\")"},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"offset-vector-computation","dir":"Articles","previous_headings":"Common Steps (CPU and GPU)","what":"2. Offset Vector Computation","title":"devil statistical model, CPU and GPU implementation","text":"offset vector incorporates size factors model:","code":"# The offset is computed as: log(size_factor) + offset_constant offset_constant <- 0  # default offset_vector <- log(fit_normed$size_factors) + offset_constant  # Visualize the relationship data.frame(     size_factor = fit_normed$size_factors,     offset = fit_normed$offset_vector ) %>%     ggplot(aes(x = size_factor, y = offset)) +     geom_point(alpha = 0.5) +     geom_smooth(method = \"lm\", se = FALSE, color = \"red\") +     theme_bw() +     labs(title = \"Relationship between size factors and offsets\",          x = \"Size factor\", y = \"Offset (log scale)\") #> `geom_smooth()` using formula = 'y ~ x'"},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"cpu-implementation","dir":"Articles","previous_headings":"","what":"CPU Implementation","title":"devil statistical model, CPU and GPU implementation","text":"CPU implementation processes genes parallel using multiple cores.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"workflow-overview","dir":"Articles","previous_headings":"CPU Implementation","what":"Workflow Overview","title":"devil statistical model, CPU and GPU implementation","text":"","code":"1. Initialize overdispersion parameters (Œ∏)    ‚îú‚îÄ If init_overdispersion = NULL: estimate from data    ‚îî‚îÄ Otherwise: use provided value     2. Initialize beta coefficients (Œ≤)    ‚îú‚îÄ If init_beta_rough = TRUE: simple log-mean initialization    ‚îî‚îÄ Otherwise: proper GLM initialization     3. Fit beta coefficients (parallel across genes)     4. Fit overdispersion parameters (parallel across genes)    ‚îú‚îÄ \"MOM\": Method of moments (fast, non-iterative)    ‚îî‚îÄ \"old\"/\"MLE\": Maximum likelihood with Cox-Reid adjustment"},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"cpu-example-with-detailed-timing","dir":"Articles","previous_headings":"CPU Implementation","what":"CPU Example with Detailed Timing","title":"devil statistical model, CPU and GPU implementation","text":"","code":"# Small dataset for demonstration set.seed(456)  n_genes_small <- 50 n_cells_small <- 10000  # Gene-specific baseline expression (log-normal is realistic for RNA-seq) gene_means <- rlnorm(   n_genes_small,   meanlog = log(15),   sdlog   = 0.8 )  # Gene-specific overdispersion (theta) gene_theta <- rlnorm(   n_genes_small,   meanlog = log(3),   sdlog   = 0.7 )  counts_small <- matrix(   0,   nrow = n_genes_small,   ncol = n_cells_small )  for (g in seq_len(n_genes_small)) {   counts_small[g, ] <- rnbinom(     n_cells_small,     mu   = gene_means[g],     size = gene_theta[g]   ) }  rownames(counts_small) <- paste0(\"Gene\", seq_len(n_genes_small)) colnames(counts_small) <- paste0(\"Cell\", seq_len(n_cells_small))  # Two-group design design_small <- model.matrix(   ~ factor(rep(c(\"Control\", \"Treatment\"), each = n_cells_small / 2)) )  # CPU fit with different overdispersion strategies system.time({     fit_cpu_mom <- fit_devil(         input_matrix = counts_small,         design_matrix = design_small,         size_factors = \"normed_sum\",         overdispersion = \"MOM\",         parallel.cores = 1,         verbose = TRUE     ) }) #> Compute size factors #> Calculating size factors using method: normed_sum #> Size factors calculated successfully. #> Range: [0.6759, 1.6736] #> Initialize theta #> Initialize beta #> Fitting beta coefficients #> Fit overdispersion (mode = MOM) #>    user  system elapsed  #>   0.129   0.184   0.096  system.time({     fit_cpu_new <- fit_devil(         input_matrix = counts_small,         design_matrix = design_small,         size_factors = \"normed_sum\",         overdispersion = \"MLE\",         parallel.cores = 1,         verbose = TRUE     ) }) #> Compute size factors #> Calculating size factors using method: normed_sum #> Size factors calculated successfully. #> Range: [0.6759, 1.6736] #> Initialize theta #> Initialize beta #> Fitting beta coefficients #> Fit overdispersion (mode = MLE) #>    user  system elapsed  #>   0.324   0.580   0.243"},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"examining-iteration-counts","dir":"Articles","previous_headings":"CPU Implementation > CPU Example with Detailed Timing","what":"Examining Iteration Counts","title":"devil statistical model, CPU and GPU implementation","text":"","code":"# Beta fitting iterations (per gene) beta_iter_summary <- data.frame(     iterations = fit_cpu_new$iterations$beta_iters )  ggplot(beta_iter_summary, aes(x = iterations)) +     geom_histogram(bins = 20, fill = \"steelblue\", alpha = 0.7) +     theme_bw() +     labs(title = \"Beta coefficient fitting: iterations per gene\",          x = \"Number of iterations\", y = \"Number of genes\") # Theta fitting iterations (per gene) if (!is.na(fit_cpu_new$iterations$theta_iters[1])) {     theta_iter_summary <- data.frame(         iterations = fit_cpu_new$iterations$theta_iters     )          ggplot(theta_iter_summary, aes(x = iterations)) +         geom_histogram(bins = 20, fill = \"coral\", alpha = 0.7) +         theme_bw() +         labs(title = \"Overdispersion fitting: iterations per gene\",              x = \"Number of iterations\", y = \"Number of genes\") }"},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"overdispersion-estimation-strategies","dir":"Articles","previous_headings":"CPU Implementation","what":"Overdispersion Estimation Strategies","title":"devil statistical model, CPU and GPU implementation","text":"CPU implementation offers three strategies estimating overdispersion:","code":""},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"method-of-moments-mom---fastest","dir":"Articles","previous_headings":"CPU Implementation > Overdispersion Estimation Strategies","what":"1. Method of Moments (MOM) - Fastest","title":"devil statistical model, CPU and GPU implementation","text":"use: Large datasets GPU-based workflows, speed scalability critical fully iterative dispersion fit impractical. works: regression setting, MOM rely raw sample mean variance counts. Instead, estimates overdispersion residual variability around fitted mean Œºij\\mu_{ij} implied design matrix offsets. Concretely, fitting (updating) regression coefficients ùõÉi\\boldsymbol{\\beta}_i, devil computes fitted means Œºij\\mu_{ij} matches negative binomial mean‚Äìvariance relationship Var(Yij)=Œºij+Œºij2Œ∏i \\mathrm{Var}(Y_{ij}) = \\mu_{ij} + \\frac{\\mu_{ij}^2}{\\theta_i}  using squared residuals (yij‚àíŒºij)2(y_{ij}-\\mu_{ij})^2 obtain closed-form, non-iterative estimate Œ∏i\\theta_i. makes MOM extremely fast well suited large-scale single-cell analyses, still accounting effects covariates normalization Œºij\\mu_{ij}.","code":"fit_mom <- fit_devil(     input_matrix = counts_small,     design_matrix = design_small,     overdispersion = \"MOM\",     verbose = FALSE )  # MOM is non-iterative (0 iterations) print(paste(\"Theta iterations (MOM):\", unique(fit_mom$iterations$theta_iters))) #> [1] \"Theta iterations (MOM): 0\""},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"mle-with-cox-reid-mle---most-accurate","dir":"Articles","previous_headings":"CPU Implementation > Overdispersion Estimation Strategies","what":"2. MLE with Cox-Reid (MLE) - Most Accurate","title":"devil statistical model, CPU and GPU implementation","text":"use: Maximum precision, small datasets. works: Maximum likelihood estimation Cox-Reid adjustment.","code":"fit_mle <- fit_devil(     input_matrix = counts_small,     design_matrix = design_small,     overdispersion = \"old\",     max_iter = 200,     verbose = FALSE )"},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"comparing-overdispersion-estimates","dir":"Articles","previous_headings":"CPU Implementation > Overdispersion Estimation Strategies","what":"Comparing Overdispersion Estimates","title":"devil statistical model, CPU and GPU implementation","text":"Interpretation: Methods generally agree, MLE may provide stable estimates difficult genes. MOM fastest may less precise genes extreme overdispersion.","code":"theta_comparison <- data.frame(     gene = seq_len(n_genes_small),     MOM = fit_mom$overdispersion,     MLE = fit_mle$overdispersion )  theta_comparison %>%     #pivot_longer(-gene, names_to = \"method\", values_to = \"theta\") %>%     ggplot(aes(x = log10(MOM), y = log10(MLE))) +     geom_point() +     theme_bw() +     labs(title = \"Overdispersion estimates across methods\",          x = \"log10(Œ∏ MOM)\", y = \"log10(Œ∏ MLE)\") # Correlation between methods cor(theta_comparison[, -1]) %>% round(3) #>     MOM MLE #> MOM   1   1 #> MLE   1   1"},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"beta-initialization-strategies","dir":"Articles","previous_headings":"CPU Implementation","what":"Beta Initialization Strategies","title":"devil statistical model, CPU and GPU implementation","text":"Recommendation: - init_beta_rough = FALSE (default): Proper GLM initialization, robust - init_beta_rough = TRUE: Faster large datasets rough initialization simply uses log(mean(y) + 1) intercept zeros coefficients. proper initialization fits simplified GLM get better starting values.","code":"# Compare initialization strategies time_rough <- system.time({     fit_rough <- fit_devil(         input_matrix = counts_small,         design_matrix = design_small,         init_beta_rough = TRUE,         verbose = FALSE     ) })  time_proper <- system.time({     fit_proper <- fit_devil(         input_matrix = counts_small,         design_matrix = design_small,         init_beta_rough = FALSE,         verbose = FALSE     ) })  print(paste(\"Rough init:\", round(time_rough[\"elapsed\"], 2), \"sec\")) #> [1] \"Rough init: 0.06 sec\" print(paste(\"Proper init:\", round(time_proper[\"elapsed\"], 2), \"sec\")) #> [1] \"Proper init: 0.09 sec\"  # Check if results are similar cor(fit_rough$beta[, 2], fit_proper$beta[, 2]) #> [1] 0.9999904"},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"gpu-implementation-conceptual","dir":"Articles","previous_headings":"","what":"GPU Implementation (Conceptual)","title":"devil statistical model, CPU and GPU implementation","text":"GPU implementation uses CUDA massive parallelization across genes.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/devil_GPU_v_CPU.html","id":"gpu-workflow","dir":"Articles","previous_headings":"GPU Implementation (Conceptual)","what":"GPU Workflow","title":"devil statistical model, CPU and GPU implementation","text":"","code":"1. Compute size factors and offsets (same as CPU)    ‚îî‚îÄ This preprocessing happens on CPU  2. Batch genes for memory efficiency    ‚îú‚îÄ Genes are divided into batches of size 'batch_size'    ‚îî‚îÄ Default: 1024 genes per batch  3. GPU kernel: Fit beta coefficients    ‚îú‚îÄ Each GPU thread handles one gene    ‚îú‚îÄ Thousands of genes fitted simultaneously    ‚îî‚îÄ Iterative weighted least squares on GPU  4. Overdispersion: Method of Moments only    ‚îú‚îÄ Computed on GPU (non-iterative)    ‚îî‚îÄ Fast calculation across all genes"},{"path":[]},{"path":"https://caravagnalab.github.io/devil/articles/getStarted.html","id":"installation","dir":"Articles","previous_headings":"","what":"Installation","title":"Get started","text":"can install current version devil GitHub :","code":"devtools::install_github(\"caravagnalab/devil\")"},{"path":"https://caravagnalab.github.io/devil/articles/getStarted.html","id":"example","dir":"Articles","previous_headings":"","what":"Example","title":"Get started","text":"tutorial walks minimal, end--end workflow differential expression (DE) devil public scRNA-seq dataset. : (1) load data, (2) filter cells/genes, (3) build design, (4) fit model, (5) specify contrasts, (6) visualize results. study multiple patients/donors, devil can compute clustered (patient-aware) standard errors via cluster argument.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/getStarted.html","id":"prerequisites","dir":"Articles","previous_headings":"Example","what":"Prerequisites","title":"Get started","text":"","code":"# If needed: # install.packages(\"BiocManager\") # BiocManager::install(c(\"scRNAseq\",\"SingleCellExperiment\"))  library(devil) library(scRNAseq) #> Loading required package: SingleCellExperiment #> Loading required package: SummarizedExperiment #> Loading required package: MatrixGenerics #> Loading required package: matrixStats #>  #> Attaching package: 'MatrixGenerics' #> The following objects are masked from 'package:matrixStats': #>  #>     colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse, #>     colCounts, colCummaxs, colCummins, colCumprods, colCumsums, #>     colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs, #>     colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats, #>     colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds, #>     colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads, #>     colWeightedMeans, colWeightedMedians, colWeightedSds, #>     colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet, #>     rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods, #>     rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps, #>     rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins, #>     rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks, #>     rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars, #>     rowWeightedMads, rowWeightedMeans, rowWeightedMedians, #>     rowWeightedSds, rowWeightedVars #> Loading required package: GenomicRanges #> Loading required package: stats4 #> Loading required package: BiocGenerics #> Loading required package: generics #>  #> Attaching package: 'generics' #> The following objects are masked from 'package:base': #>  #>     as.difftime, as.factor, as.ordered, intersect, is.element, setdiff, #>     setequal, union #>  #> Attaching package: 'BiocGenerics' #> The following objects are masked from 'package:stats': #>  #>     IQR, mad, sd, var, xtabs #> The following objects are masked from 'package:base': #>  #>     anyDuplicated, aperm, append, as.data.frame, basename, cbind, #>     colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find, #>     get, grep, grepl, is.unsorted, lapply, Map, mapply, match, mget, #>     order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank, #>     rbind, Reduce, rownames, sapply, saveRDS, table, tapply, unique, #>     unsplit, which.max, which.min #> Loading required package: S4Vectors #>  #> Attaching package: 'S4Vectors' #> The following object is masked from 'package:utils': #>  #>     findMatches #> The following objects are masked from 'package:base': #>  #>     expand.grid, I, unname #> Loading required package: IRanges #> Loading required package: Seqinfo #> Loading required package: Biobase #> Welcome to Bioconductor #>  #>     Vignettes contain introductory material; view with #>     'browseVignettes()'. To cite Bioconductor, see #>     'citation(\"Biobase\")', and for packages 'citation(\"pkgname\")'. #>  #> Attaching package: 'Biobase' #> The following object is masked from 'package:MatrixGenerics': #>  #>     rowMedians #> The following objects are masked from 'package:matrixStats': #>  #>     anyMissing, rowMedians library(SingleCellExperiment) library(SummarizedExperiment) library(Matrix) #>  #> Attaching package: 'Matrix' #> The following object is masked from 'package:S4Vectors': #>  #>     expand library(dplyr) #>  #> Attaching package: 'dplyr' #> The following object is masked from 'package:Biobase': #>  #>     combine #> The following objects are masked from 'package:GenomicRanges': #>  #>     intersect, setdiff, union #> The following object is masked from 'package:Seqinfo': #>  #>     intersect #> The following objects are masked from 'package:IRanges': #>  #>     collapse, desc, intersect, setdiff, slice, union #> The following objects are masked from 'package:S4Vectors': #>  #>     first, intersect, rename, setdiff, setequal, union #> The following objects are masked from 'package:BiocGenerics': #>  #>     combine, intersect, setdiff, setequal, union #> The following object is masked from 'package:generics': #>  #>     explain #> The following object is masked from 'package:matrixStats': #>  #>     count #> The following objects are masked from 'package:stats': #>  #>     filter, lag #> The following objects are masked from 'package:base': #>  #>     intersect, setdiff, setequal, union"},{"path":"https://caravagnalab.github.io/devil/articles/getStarted.html","id":"load-and-inspect-data","dir":"Articles","previous_headings":"Example","what":"Load and inspect data","title":"Get started","text":"‚Äôll use Baron pancreas dataset scRNAseq. Extract counts metadata using accessors: Tip: patient/donor column (often donor patient), keep , ‚Äôll optionally pass cluste= later.","code":"sce <- scRNAseq::BaronPancreasData() # SingleCellExperiment sce #> class: SingleCellExperiment  #> dim: 20125 8569  #> metadata(0): #> assays(1): counts #> rownames(20125): A1BG A1CF ... ZZZ3 pk #> rowData names(0): #> colnames(8569): human1_lib1.final_cell_0001 human1_lib1.final_cell_0002 #>   ... human4_lib3.final_cell_0700 human4_lib3.final_cell_0701 #> colData names(2): donor label #> reducedDimNames(0): #> mainExpName: NULL #> altExpNames(0): counts <- SummarizedExperiment::assay(sce, \"counts\") meta <- as.data.frame(SummarizedExperiment::colData(sce))  cat(\"Genes:\", nrow(counts), \"\\nCells:\", ncol(counts), \"\\n\") #> Genes: 20125  #> Cells: 8569 stopifnot(\"label\" %in% colnames(meta)) head(meta$label) #> [1] \"acinar\" \"acinar\" \"acinar\" \"acinar\" \"acinar\" \"acinar\""},{"path":"https://caravagnalab.github.io/devil/articles/getStarted.html","id":"light-filtering","dir":"Articles","previous_headings":"Example","what":"Light filtering","title":"Get started","text":"Keep three abundant cell types; filter lowly expressed genes. Optionally restrict highly expressed genes faster demo (skip real analyses):","code":"# keep 3 largest cell types top3 <- names(sort(table(meta$label), decreasing = TRUE))[1:3] keep_cells <- meta$label %in% top3 counts <- counts[, keep_cells, drop = FALSE] meta <- meta[keep_cells, , drop = FALSE]  # gene filter: expressed (>=1 UMI) in >= 1% of kept cells min_cells <- max(1, floor(0.01 * ncol(counts))) keep_genes <- Matrix::rowSums(counts >= 1) >= min_cells counts <- counts[keep_genes, , drop = FALSE]  cat(\"After filtering ‚Äî Genes:\", nrow(counts), \"Cells:\", ncol(counts), \"\\n\") #> After filtering ‚Äî Genes: 11951 Cells: 5928 table(meta$label) #>  #>  alpha   beta ductal  #>   2326   2525   1077 # demo mode: top 500 genes by total counts if (nrow(counts) > 500) {     ord <- order(Matrix::rowSums(counts), decreasing = TRUE)     counts <- counts[ord[seq_len(500)], ] }"},{"path":"https://caravagnalab.github.io/devil/articles/getStarted.html","id":"design-matrix","dir":"Articles","previous_headings":"Example","what":"Design matrix","title":"Get started","text":"Build -intercept design coefficient corresponds cell type. (Optional) Cluster variable patient-aware SEs, available:","code":"meta$label <- droplevels(factor(meta$label)) design <- model.matrix(~ 0 + label, data = meta) colnames(design) <- gsub(\"^label\", \"\", colnames(design)) colnames(design) #> [1] \"alpha\"  \"beta\"   \"ductal\" cluster <- NULL if (\"donor\" %in% names(meta)) cluster <- factor(meta$donor) if (is.null(cluster) && \"patient\" %in% names(meta)) cluster <- factor(meta$patient)"},{"path":"https://caravagnalab.github.io/devil/articles/getStarted.html","id":"fit-the-model","dir":"Articles","previous_headings":"Example","what":"Fit the model","title":"Get started","text":"fit_devil() expects counts matrix (genes √ó cells), design (cells √ó covariates). parameters size_factors=\"normed_sum\" computes internally size factor scale expression based library size cell.","code":"fit <- devil::fit_devil(     input_matrix = as.matrix(counts),     design_matrix = design,     overdispersion = \"MOM\",     offset = 1e-6,     init_overdispersion = NULL,     size_factors = \"normed_sum\",     parallel.cores = 1,     verbose = TRUE,     max_iter = 200,     tolerance = 1e-4 ) #> Compute size factors #> Calculating size factors using method: normed_sum #> Size factors calculated successfully. #> Range: [0.1036, 8.0148] #> Initialize theta #> Initialize beta #> Fitting beta coefficients #> Fit overdispersion (mode = MOM)"},{"path":"https://caravagnalab.github.io/devil/articles/getStarted.html","id":"specify-contrasts","dir":"Articles","previous_headings":"Example","what":"Specify contrasts","title":"Get started","text":"-intercept design, column cell-type mean log scale. test ‚Äúbeta vs ductal‚Äù, define contrast (+1 * beta) + (-1 * ductal) zero elsewhere. labels differ, update /accordingly‚Äîuse colnames(design) see available levels.","code":"make_contrast <- function(design, from, to) {     stopifnot(from %in% colnames(design), to %in% colnames(design))     c <- rep(0, ncol(design))     names(c) <- colnames(design)     c[from] <- 1     c[to] <- -1     as.numeric(c) }  contrast <- make_contrast(design, from = \"beta\", to = \"ductal\") contrast #> [1]  0  1 -1"},{"path":"https://caravagnalab.github.io/devil/articles/getStarted.html","id":"test-for-differential-expression","dir":"Articles","previous_headings":"Example","what":"Test for differential expression","title":"Get started","text":"Run Wald test optional clustered SEs cluster exists. Quick peek top hits:","code":"test <- devil::test_de(     fit,     contrast = contrast,     max_lfc  = 20, # Cap extreme fold changes     cluster  = cluster # NULL if not present; enables patient-aware SE if provided ) #> Converting clusters to numeric factors  # Add gene names if missing if (!(\"name\" %in% colnames(test))) {     if (!is.null(rownames(counts))) {         test$name <- rownames(counts)     } else {         test$name <- as.character(seq_len(nrow(test)))     } } test %>%     dplyr::arrange(adj_pval, desc(abs(lfc))) %>%     dplyr::select(name, lfc, pval, adj_pval) %>%     head(10) #> # A tibble: 10 √ó 4 #>    name      lfc      pval  adj_pval #>    <chr>   <dbl>     <dbl>     <dbl> #>  1 KRT7    -9.35 5.43e-212 2.72e-209 #>  2 CPE      4.40 7.38e-171 1.85e-168 #>  3 HADH     3.32 6.30e-150 1.05e-147 #>  4 CD24    -3.77 6.80e-136 8.50e-134 #>  5 PEMT     3.95 1.37e-126 1.37e-124 #>  6 PMEPA1  -7.03 1.63e-124 1.36e-122 #>  7 TACSTD2 -8.83 2.52e-117 1.80e-115 #>  8 S100A10 -6.08 5.73e-111 3.58e-109 #>  9 UCHL1    4.63 1.39e-107 7.72e-106 #> 10 TMOD1    4.67 5.65e-103 2.82e-101"},{"path":"https://caravagnalab.github.io/devil/articles/getStarted.html","id":"visualize-results","dir":"Articles","previous_headings":"Example","what":"Visualize results","title":"Get started","text":"Volcano plot DE genes","code":"devil::plot_volcano(     test,     lfc_cut = 1,     pval_cut = 0.05,     labels = TRUE,     point_size = 1.8,     title = \"beta vs ductal\" )"},{"path":"https://caravagnalab.github.io/devil/articles/getStarted.html","id":"session-info","dir":"Articles","previous_headings":"Example","what":"Session info","title":"Get started","text":"","code":"sessionInfo() #> R version 4.5.2 (2025-10-31) #> Platform: x86_64-pc-linux-gnu #> Running under: Ubuntu 24.04.3 LTS #>  #> Matrix products: default #> BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  #> LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0 #>  #> locale: #>  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8        #>  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8    #>  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C           #> [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C    #>  #> time zone: UTC #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats4    stats     graphics  grDevices utils     datasets  methods   #> [8] base      #>  #> other attached packages: #>  [1] dplyr_1.1.4                 Matrix_1.7-4                #>  [3] scRNAseq_2.24.0             SingleCellExperiment_1.32.0 #>  [5] SummarizedExperiment_1.40.0 Biobase_2.70.0              #>  [7] GenomicRanges_1.62.1        Seqinfo_1.0.0               #>  [9] IRanges_2.44.0              S4Vectors_0.48.0            #> [11] BiocGenerics_0.56.0         generics_0.1.4              #> [13] MatrixGenerics_1.22.0       matrixStats_1.5.0           #> [15] devil_0.99.0                #>  #> loaded via a namespace (and not attached): #>   [1] DBI_1.2.3                 bitops_1.0-9              #>   [3] httr2_1.2.2               rlang_1.1.6               #>   [5] magrittr_2.0.4            gypsum_1.6.0              #>   [7] compiler_4.5.2            RSQLite_2.4.5             #>   [9] DelayedMatrixStats_1.32.0 GenomicFeatures_1.62.0    #>  [11] png_0.1-8                 systemfonts_1.3.1         #>  [13] vctrs_0.6.5               ProtGenerics_1.42.0       #>  [15] pkgconfig_2.0.3           crayon_1.5.3              #>  [17] fastmap_1.2.0             dbplyr_2.5.1              #>  [19] XVector_0.50.0            labeling_0.4.3            #>  [21] utf8_1.2.6                Rsamtools_2.26.0          #>  [23] rmarkdown_2.30            UCSC.utils_1.6.1          #>  [25] ragg_1.5.0                bit_4.6.0                 #>  [27] xfun_0.55                 cachem_1.1.0              #>  [29] cigarillo_1.0.0           GenomeInfoDb_1.46.2       #>  [31] jsonlite_2.0.0            blob_1.2.4                #>  [33] rhdf5filters_1.22.0       DelayedArray_0.36.0       #>  [35] Rhdf5lib_1.32.0           BiocParallel_1.44.0       #>  [37] parallel_4.5.2            R6_2.6.1                  #>  [39] RColorBrewer_1.1-3        bslib_0.9.0               #>  [41] rtracklayer_1.70.1        jquerylib_0.1.4           #>  [43] Rcpp_1.1.0                knitr_1.51                #>  [45] tidyselect_1.2.1          abind_1.4-8               #>  [47] yaml_2.3.12               codetools_0.2-20          #>  [49] curl_7.0.0                lattice_0.22-7            #>  [51] alabaster.sce_1.10.0      tibble_3.3.0              #>  [53] S7_0.2.1                  withr_3.0.2               #>  [55] KEGGREST_1.50.0           evaluate_1.0.5            #>  [57] desc_1.4.3                BiocFileCache_3.0.0       #>  [59] alabaster.schemas_1.10.0  ExperimentHub_3.0.0       #>  [61] Biostrings_2.78.0         pillar_1.11.1             #>  [63] BiocManager_1.30.27       filelock_1.0.3            #>  [65] RCurl_1.98-1.17           ggplot2_4.0.1             #>  [67] BiocVersion_3.22.0        ensembldb_2.34.0          #>  [69] scales_1.4.0              sparseMatrixStats_1.22.0  #>  [71] alabaster.base_1.10.0     glue_1.8.0                #>  [73] alabaster.ranges_1.10.0   alabaster.matrix_1.10.0   #>  [75] lazyeval_0.2.2            tools_4.5.2               #>  [77] AnnotationHub_4.0.0       BiocIO_1.20.0             #>  [79] GenomicAlignments_1.46.0  fs_1.6.6                  #>  [81] XML_3.99-0.20             rhdf5_2.54.1              #>  [83] grid_4.5.2                AnnotationDbi_1.72.0      #>  [85] HDF5Array_1.38.0          restfulr_0.0.16           #>  [87] cli_3.6.5                 rappdirs_0.3.3            #>  [89] textshaping_1.0.4         S4Arrays_1.10.1           #>  [91] AnnotationFilter_1.34.0   gtable_0.3.6              #>  [93] alabaster.se_1.10.0       sass_0.4.10               #>  [95] digest_0.6.39             SparseArray_1.10.8        #>  [97] farver_2.1.2              rjson_0.2.23              #>  [99] memoise_2.0.1             htmltools_0.5.9           #> [101] pkgdown_2.2.0             lifecycle_1.0.4           #> [103] h5mread_1.2.1             httr_1.4.7                #> [105] bit64_4.6.0-1"},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"GPU and CUDA Setup","text":"guide provides instructions installing devil HPC clusters. cover standard installation GPU-accelerated installation CUDA support.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"prerequisites","dir":"Articles","previous_headings":"","what":"Prerequisites","title":"GPU and CUDA Setup","text":"proceeding, ensure : access HPC cluster module system support (e.g., Lmod) CUDA toolkit installed (version 12.0+ requested) appropriate permissions install software user space, root access installing system-wide (system administrators). principle, able install package user space assuming working Nvidia drivers CUDA installation. Note: shared HPC environments, typically don‚Äôt root access, module system (Lmod) necessary managing software dependencies.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"standard-installation-on-hpc-cluster","dir":"Articles","previous_headings":"","what":"Standard Installation on HPC Cluster","title":"GPU and CUDA Setup","text":"installation follow steps : 1. Compile install OpenBLAS module (optional) 2. Compile install R optimized BLAS support module (optional) 3. Install devil GitHub within R case GPU acceleration, additional steps provided later.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"step-1-openblas-setup","dir":"Articles","previous_headings":"Standard Installation on HPC Cluster","what":"Step 1: OpenBLAS Setup","title":"GPU and CUDA Setup","text":"Since R can use internal BLAS fallback, recommend compiling OpenBLAS optimal performance specific hardware architecture.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"compile-openblas","dir":"Articles","previous_headings":"Standard Installation on HPC Cluster > Step 1: OpenBLAS Setup","what":"Compile OpenBLAS","title":"GPU and CUDA Setup","text":"Create bash script compile OpenBLAS: Note: use pthread-based libraries instead OpenMP-based ones avoid conflicts, since devil uses OpenMP internally.","code":"#!/usr/bin/bash -e  SOURCE_PATH=\"software/source\" INSTALL_PATH=\"software/programs/openBLAS\" MODULE_PATH=\"software/modules/openBLAS\"  VERSION=\"0.3.30\" PLATFORM=\"DGX\"  # Adjust for your architecture  mkdir -p \"$INSTALL_PATH/$VERSION-$PLATFORM\"  # Clone OpenBLAS cd $SOURCE_PATH rm -rf OpenBLAS/ git clone --depth 1 --branch v$VERSION git@github.com:OpenMathLib/OpenBLAS.git  # Compile cd $SOURCE_PATH/OpenBLAS mkdir -p ${INSTALL_PATH}/$VERSION-$PLATFORM/ make clean make distclean make USE_OPENMP=0 -j $(nproc --all) make PREFIX=${INSTALL_PATH}/$VERSION-$PLATFORM/ install"},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"create-openblas-module-file","dir":"Articles","previous_headings":"Standard Installation on HPC Cluster > Step 1: OpenBLAS Setup","what":"Create OpenBLAS Module File","title":"GPU and CUDA Setup","text":"Create Lua module file OpenBLAS: Note: Adjust home variable absolute path OpenBLAS installed ! Example: /path//software/programs/openBLAS/0.3.29-DGX/","code":"-- -*- lua -*-  local name      = \"openBLAS\" local version   = \"0.3.29-DGX\"  whatis(\"Name         : \" .. name) whatis(\"Version      : \" .. version)  family(\"BLAS\")  local home    = \"software/programs/openBLAS/0.3.29-DGX/\"  prepend_path{\"PATH\", home .. \"/bin\",delim=\":\",priority=\"0\"} prepend_path{\"LD_LIBRARY_PATH\", home .. \"/lib\",delim=\":\",priority=\"0\"} prepend_path{\"LIBRARY_PATH\", home .. \"/lib\",delim=\":\",priority=\"0\"} prepend_path{\"CPATH\", home .. \"/include\",delim=\":\",priority=\"0\"} setenv(\"OPENBLAS_DIR\", home) setenv(\"OPENBLAS_ROOT\", home) setenv(\"OPENBLAS_LIB\", home .. \"/lib\") setenv(\"OPENBLAS_IN\", home .. \"/include\")"},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"step-2-r-setup","dir":"Articles","previous_headings":"Standard Installation on HPC Cluster","what":"Step 2: R Setup","title":"GPU and CUDA Setup","text":"Compile R optimized BLAS support maximum performance.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"compile-r","dir":"Articles","previous_headings":"Standard Installation on HPC Cluster > Step 2: R Setup","what":"Compile R","title":"GPU and CUDA Setup","text":"","code":"#!/usr/bin/bash  SOURCE_PATH=\"software/source\" INSTALL_PATH=\"software/programs/R\" MODULE_PATH=\"software/modules\" VERSION=\"4.3.3\" PLATFORM=\"DGX\" mkdir -p \"$INSTALL_PATH/$VERSION-$PLATFORM\"  # Download R source cd $SOURCE_PATH/ rm -rf R-4.3.3* wget https://cloud.r-project.org/src/base/R-4/R-${VERSION}.tar.gz tar -xzf R-${VERSION}.tar.gz  # Load modules module use $MODULE_PATH module load openBLAS/0.3.29-$PLATFORM  echo $OPENBLAS_LIB  # Configure and compile cd $SOURCE_PATH/R-$VERSION ./configure --prefix=${INSTALL_PATH}/${VERSION}-${PLATFORM} --with-x=no \\     --with-blas=\"-L${OPENBLAS_LIB} -lopenblas\" \\     --with-lapack=yes \\     --with-system-valgrind-headers \\     --enable-memory-profiling \\     --with-valgrind-instrumentation=2 \\     --with-jpeglib \\     --with-libpng \\     --with-tcltk \\     --with-readline \\     --with-cairo=yes \\     --enable-R-profiling \\     --with-libtiff \\     --enable-lto \\     --enable-R-shlib  make -j $(nproc --all) make install"},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"create-r-module-file","dir":"Articles","previous_headings":"Standard Installation on HPC Cluster > Step 2: R Setup","what":"Create R Module File","title":"GPU and CUDA Setup","text":"Important: Specify custom R_LIBS_USER avoid installation conflicts different architectures.","code":"-- -*- lua -*-  local name      = \"R\" local version   = \"4.3.3-DGX\" whatis(\"Name         : \" .. name) whatis(\"Version      : \" .. version)  family(\"R\") depends_on(\"openBLAS/0.3.30-DGX\")  local home    = \"software/programs/R/4.3.3-DGX\"  prepend_path(\"PATH\", home .. \"/bin\") prepend_path(\"LD_LIBRARY_PATH\", home ..\"/lib64\") prepend_path(\"MANPATH\", home ..\"/share/man\") prepend_path(\"R_LIBS_USER\",\"software/programs/r_packages_DGX\")"},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"step-3-install-devil","dir":"Articles","previous_headings":"Standard Installation on HPC Cluster","what":"Step 3: Install devil","title":"GPU and CUDA Setup","text":"Load required modules install devil: Note can specify different branch following syntax: devtools::install_github(\"caravagnalab/devill@branch_name\")","code":"# Add your software modules to the module path module use software/modules/  # Load required modules module load R/4.3.3-DGX openBLAS/0.3.30-DGX  # Install devil R # In R console devtools::install_github(\"caravagnalab/devill\")"},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"gpu-accelerated-installation-with-cuda-support","dir":"Articles","previous_headings":"","what":"GPU-Accelerated Installation with CUDA Support","title":"GPU and CUDA Setup","text":"GPU acceleration, additional setup required enable CUDA cuTENSOR support. CUDA cuTENSOR already installed configured HPC system, can skip Step 3.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"step-1-cutensor-setup","dir":"Articles","previous_headings":"GPU-Accelerated Installation with CUDA Support","what":"Step 1: cuTENSOR Setup","title":"GPU and CUDA Setup","text":"cuTENSOR distributed NVIDIA required GPU-accelerated tensor operations.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"install-cutensor","dir":"Articles","previous_headings":"GPU-Accelerated Installation with CUDA Support > Step 1: cuTENSOR Setup","what":"Install cuTENSOR","title":"GPU and CUDA Setup","text":"install several versions cuTENSOR compatible multiple CUDA versions. use version 12.0+.","code":"#!/usr/bin/bash  SOURCE_PATH=\"software/source\" INSTALL_PATH=\"software/programs/cutensor\" MODULE_PATH=\"software/modules\" VERSION=\"2.2.0.0\"  # Download cuTENSOR cd $SOURCE_PATH/ rm -rf libcutensor*  wget https://developer.download.nvidia.com/compute/cutensor/redist/libcutensor/linux-x86_64/libcutensor-linux-x86_64-$VERSION-archive.tar.xz  tar -xf libcutensor-linux-x86_64-$VERSION-archive.tar.xz cd libcutensor-linux-x86_64-$VERSION-archive/ mkdir -p $INSTALL_PATH/cutensor/$VERSION/ cp -r ./* $INSTALL_PATH/cutensor/$VERSION/"},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"create-cutensor-module-file","dir":"Articles","previous_headings":"GPU-Accelerated Installation with CUDA Support > Step 1: cuTENSOR Setup","what":"Create cuTENSOR Module File","title":"GPU and CUDA Setup","text":"create module cuTENSOR, adjusting home variable absolute path cuTENSOR installed (e.g., `/path//software/programs/cutensor/","code":"-- -*- lua -*-  local name      = \"cutensor\" local version   = \"2.2.0.0\" whatis(\"Name         : \" .. name) whatis(\"Version      : \" .. version)  family(\"cutensor\") depends_on(\"cuda\")  local home    = \"software/programs/cutensor/2.2.0.0\"  prepend_path(\"CPATH\", home .. \"/include\") prepend_path(\"INCLUDE\", home .. \"/include\") prepend_path(\"LD_LIBRARY_PATH\", home .. \"/lib/12/\") prepend_path(\"LIBRARY_PATH\", home .. \"/lib/12/\") setenv(\"CUTENSOR_HOME\", home)"},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"step-2-load-all-required-modules","dir":"Articles","previous_headings":"GPU-Accelerated Installation with CUDA Support","what":"Step 2: Load All Required Modules","title":"GPU and CUDA Setup","text":"","code":"# Add your software modules to the module path module use software/modules/  # Load all required modules for GPU support module load R/4.3.3-h100 openBLAS/0.3.29-h100 cutensor/2.2.0.0"},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"step-3-verify-environment-variables","dir":"Articles","previous_headings":"GPU-Accelerated Installation with CUDA Support","what":"Step 3: Verify Environment Variables","title":"GPU and CUDA Setup","text":"installing devil GPU support, verify essential environment variables correctly set: Important: environment variables CUDA_HOME CUTENSOR_HOME essential compiling devil GPU support.","code":"# Check OpenBLAS echo $OPENBLAS_LIB # Expected output (example): # /path/to/software/programs/openBLAS/0.3.29-h100/lib  # Check CUDA echo $CUDA_HOME # Expected output (example): # /opt/programs/cuda/12.1  # Check cuTENSOR echo $CUTENSOR_HOME # Expected output (example): # /path/to/software/programs/cutensor/2.2.0.0"},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"step-4-install-devil-with-gpu-support","dir":"Articles","previous_headings":"GPU-Accelerated Installation with CUDA Support","what":"Step 4: Install devil with GPU Support","title":"GPU and CUDA Setup","text":"modules loaded environment variables verified, just install devil following command: installation automatically detect CUDA cuTENSOR libraries compile GPU-accelerated code.","code":"# In R console devtools::install_github(\"caravagnalab/devil\", configure.args = \"--with-cuda\")"},{"path":"https://caravagnalab.github.io/devil/articles/gpuSetup.html","id":"notes-on-module-paths","dir":"Articles","previous_headings":"","what":"Notes on Module Paths","title":"GPU and CUDA Setup","text":"Important: module files provided use relative paths. need adjust absolute paths system. Additionally, ensure working CUDA installation configured HPC system administrators.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/quickSetup.html","id":"quick-start","dir":"Articles","previous_headings":"","what":"Quick Start","title":"Quick Setup","text":"guide provides streamlined installation instructions devil package. Choose installation method best suits computational needs.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/quickSetup.html","id":"standard-installation","dir":"Articles","previous_headings":"","what":"Standard Installation","title":"Quick Setup","text":"users, standard CPU-based installation recommended: don‚Äôt devtools installed:","code":"# Install from GitHub devtools::install_github(\"caravagnalab/devil\") install.packages(\"devtools\") devtools::install_github(\"caravagnalab/devil\")"},{"path":"https://caravagnalab.github.io/devil/articles/quickSetup.html","id":"gpu-accelerated-installation","dir":"Articles","previous_headings":"","what":"GPU-Accelerated Installation","title":"Quick Setup","text":"users NVIDIA GPUs want leverage GPU acceleration faster computations.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/quickSetup.html","id":"prerequisites","dir":"Articles","previous_headings":"GPU-Accelerated Installation","what":"Prerequisites","title":"Quick Setup","text":"installing GPU-accelerated version, ensure : CUDA Toolkit (version 12.0 higher) - Download cuTENSOR Library - Download CUDA_HOME: Path CUDA installation directory CUTENSOR_HOME: Path cuTENSOR installation directory","code":""},{"path":"https://caravagnalab.github.io/devil/articles/quickSetup.html","id":"verifying-your-environment","dir":"Articles","previous_headings":"GPU-Accelerated Installation","what":"Verifying Your Environment","title":"Quick Setup","text":"Check environment variables set correctly: commands return valid directory paths. return empty strings, ‚Äôll need set variables proceeding.","code":"# Check CUDA_HOME Sys.getenv(\"CUDA_HOME\")  # Check CUTENSOR_HOME Sys.getenv(\"CUTENSOR_HOME\")"},{"path":"https://caravagnalab.github.io/devil/articles/quickSetup.html","id":"installation-command","dir":"Articles","previous_headings":"GPU-Accelerated Installation","what":"Installation Command","title":"Quick Setup","text":"prerequisites met: package automatically detect CUDA installation compile GPU support.","code":"devtools::install_github(\"caravagnalab/devil\", configure.args = \"--with-cuda\")"},{"path":"https://caravagnalab.github.io/devil/articles/quickSetup.html","id":"troubleshooting","dir":"Articles","previous_headings":"","what":"Troubleshooting","title":"Quick Setup","text":"installation fails: Verify CUDA toolkit installation: nvcc --version terminal Confirm environment variables set system-wide, just R session Ensure GPU drivers date Check CUDA version compatible GPU architecture additional help, please open issue GitHub repository.","code":""},{"path":"https://caravagnalab.github.io/devil/articles/quickSetup.html","id":"next-steps","dir":"Articles","previous_headings":"","what":"Next Steps","title":"Quick Setup","text":"successful installation, load package: Continue main vignettes learn use devil analysis.","code":"library(devil)"},{"path":"https://caravagnalab.github.io/devil/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Giovanni Santacatterina. Author, maintainer.","code":""},{"path":"https://caravagnalab.github.io/devil/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Santacatterina G (2026). devil: devil. R package version 0.99.0, https://caravagnalab.github.io/devil/.","code":"@Manual{,   title = {devil: devil},   author = {Giovanni Santacatterina},   year = {2026},   note = {R package version 0.99.0},   url = {https://caravagnalab.github.io/devil/}, }"},{"path":"https://caravagnalab.github.io/devil/index.html","id":"devil-","dir":"","previous_headings":"","what":"devil","title":"devil","text":"devil R package differential expression analysis single-cell RNA sequencing (scRNA-seq) data. supports single- multi-patient experimental designs, implementing robust statistical methods identify differentially expressed genes accounting technical biological variability. Key features : Flexible experimental design support (single/multiple patients) Robust statistical testing framework Efficient implementation large-scale datasets","code":""},{"path":"https://caravagnalab.github.io/devil/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"devil","text":"can install current version devil GitHub :","code":"devtools::install_github(\"caravagnalab/devil\")"},{"path":"https://caravagnalab.github.io/devil/index.html","id":"example","dir":"","previous_headings":"","what":"Example","title":"devil","text":"basic example shows fit expression single gene observed 1000 cells.","code":"library(devil) y <- t(as.matrix(rnbinom(1000, 1, .1))) fit <- devil::fit_devil(input_matrix = y, design_matrix = matrix(1, ncol = 1, nrow = 1000), verbose = T, size_factors = NULL, overdispersion = \"MOM\") #> Initialize theta #> Initialize beta #> Fitting beta coefficients #> Fit overdispersion (mode = MOM) test <- devil::test_de(fit, contrast = c(1))"},{"path":"https://caravagnalab.github.io/devil/index.html","id":"copyright-and-contacts","dir":"","previous_headings":"Example","what":"Copyright and contacts","title":"devil","text":"Giulio Caravagna, Giovanni Santacatterina. Cancer Data Science (CDS) Laboratory.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/calculate_sf.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Size Factors for Count Data Normalization ‚Äî calculate_sf","title":"Calculate Size Factors for Count Data Normalization ‚Äî calculate_sf","text":"Computes normalization factors count data using one three methods: geometric mean normalization (normed_sum), psi-normalization (psinorm), edgeR's TMM singleton pairing (edgeR). Handles edge cases like -zero columns matrices rows.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/calculate_sf.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Size Factors for Count Data Normalization ‚Äî calculate_sf","text":"","code":"calculate_sf(Y, method = c(\"normed_sum\", \"psinorm\", \"edgeR\"), verbose = FALSE)"},{"path":"https://caravagnalab.github.io/devil/reference/calculate_sf.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Size Factors for Count Data Normalization ‚Äî calculate_sf","text":"Y Count data matrix genes rows samples columns method Character string specifying normalization method. One : \"normed_sum\" (default): Geometric mean normalization based library sizes \"psinorm\": Psi-normalization using Pareto distribution MLE \"edgeR\": edgeR's TMM singleton pairing method verbose Logical indicating whether print progress messages","code":""},{"path":"https://caravagnalab.github.io/devil/reference/calculate_sf.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Size Factors for Count Data Normalization ‚Äî calculate_sf","text":"Numeric vector size factors, one per sample (column). Size factors scaled geometric mean 1.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/calculate_sf.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calculate Size Factors for Count Data Normalization ‚Äî calculate_sf","text":"Size factors used normalize count data differences sequencing depth RNA composition across samples. function return vector 1s input matrix one row. \"normed_sum\" method computes size factors column sums divided geometric mean. \"psinorm\" method uses maximum likelihood estimation Pareto distribution parameters compute size factors robust highly variable genes. \"edgeR\" method requires edgeR package installed uses TMM (trimmed mean M-values) method singleton pairing.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/compute_offset_vector.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute Offset Matrix for Statistical Model ‚Äî compute_offset_vector","title":"Compute Offset Matrix for Statistical Model ‚Äî compute_offset_vector","text":"Creates offset matrix incorporating base offsets optional size factors model fitting.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/compute_offset_vector.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute Offset Matrix for Statistical Model ‚Äî compute_offset_vector","text":"","code":"compute_offset_vector(off, Y, size_factors)"},{"path":"https://caravagnalab.github.io/devil/reference/compute_offset_vector.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute Offset Matrix for Statistical Model ‚Äî compute_offset_vector","text":"Base offset value Y Count data matrix genes rows samples columns size_factors Optional vector size factors normalization","code":""},{"path":"https://caravagnalab.github.io/devil/reference/compute_offset_vector.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute Offset Matrix for Statistical Model ‚Äî compute_offset_vector","text":"Matrix offset values gene-sample combination","code":""},{"path":"https://caravagnalab.github.io/devil/reference/compute_sandwich.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute Sandwich Estimator for Statistical Model ‚Äî compute_sandwich","title":"Compute Sandwich Estimator for Statistical Model ‚Äî compute_sandwich","text":"Calculates sandwich estimator robust covariance estimation, particularly useful clustered heteroskedastic data scenarios.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/compute_sandwich.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute Sandwich Estimator for Statistical Model ‚Äî compute_sandwich","text":"","code":"compute_sandwich(   design_matrix,   y,   beta,   overdispersion,   size_factors,   clusters )"},{"path":"https://caravagnalab.github.io/devil/reference/compute_sandwich.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute Sandwich Estimator for Statistical Model ‚Äî compute_sandwich","text":"design_matrix Matrix predictor variables y Vector response variables beta Vector coefficient estimates overdispersion Scalar overdispersion parameter size_factors Vector normalization factors sample clusters Vector indicating cluster membership","code":""},{"path":"https://caravagnalab.github.io/devil/reference/compute_sandwich.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute Sandwich Estimator for Statistical Model ‚Äî compute_sandwich","text":"Matrix containing sandwich estimator","code":""},{"path":"https://caravagnalab.github.io/devil/reference/devil-package.html","id":null,"dir":"Reference","previous_headings":"","what":"devil: devil ‚Äî devil-package","title":"devil: devil ‚Äî devil-package","text":"devil R package fast, scalable differential expression analysis single-cell single-nucleus RNA-sequencing data. designed operate directly cell level accounting complex experimental structure. employs statistical framework based generalized linear models cluster-robust (sandwich) covariance estimators, enabling valid inference presence multi-patient, multi-sample, repeated-measurement designs. support analyses atlas scale, devil combines efficient variational inference optional GPU acceleration, delivering substantial gains runtime memory efficiency retaining accurate well-calibrated statistical tests.","code":""},{"path":[]},{"path":"https://caravagnalab.github.io/devil/reference/devil-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"devil: devil ‚Äî devil-package","text":"Maintainer: Giovanni Santacatterina santacatterinagiovanni@gmail.com","code":""},{"path":"https://caravagnalab.github.io/devil/reference/edgeR_sf.html","id":null,"dir":"Reference","previous_headings":"","what":"edgeR TMM Size Factors ‚Äî edgeR_sf","title":"edgeR TMM Size Factors ‚Äî edgeR_sf","text":"Computes size factors using edgeR's TMM (trimmed mean M-values) method singleton pairing.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/edgeR_sf.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"edgeR TMM Size Factors ‚Äî edgeR_sf","text":"","code":"edgeR_sf(Y)"},{"path":"https://caravagnalab.github.io/devil/reference/edgeR_sf.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"edgeR TMM Size Factors ‚Äî edgeR_sf","text":"Y Count data matrix genes rows samples columns","code":""},{"path":"https://caravagnalab.github.io/devil/reference/edgeR_sf.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"edgeR TMM Size Factors ‚Äî edgeR_sf","text":"Numeric vector size factors","code":""},{"path":"https://caravagnalab.github.io/devil/reference/estimate_dispersion.html","id":null,"dir":"Reference","previous_headings":"","what":"Estimate Dispersion Parameters for Count Matrix ‚Äî estimate_dispersion","title":"Estimate Dispersion Parameters for Count Matrix ‚Äî estimate_dispersion","text":"Calculates per-gene dispersion estimates count matrix using method moments approach. Handles edge cases setting default high dispersion value.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/estimate_dispersion.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Estimate Dispersion Parameters for Count Matrix ‚Äî estimate_dispersion","text":"","code":"estimate_dispersion(count_matrix, offset_vector)"},{"path":"https://caravagnalab.github.io/devil/reference/estimate_dispersion.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Estimate Dispersion Parameters for Count Matrix ‚Äî estimate_dispersion","text":"count_matrix Matrix count data genes rows samples columns offset_vector Vector offset values normalization","code":""},{"path":"https://caravagnalab.github.io/devil/reference/estimate_dispersion.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Estimate Dispersion Parameters for Count Matrix ‚Äî estimate_dispersion","text":"Vector dispersion estimates, one per gene","code":""},{"path":"https://caravagnalab.github.io/devil/reference/fit_devil.html","id":null,"dir":"Reference","previous_headings":"","what":"Fit Statistical Model for Count Data ‚Äî fit_devil","title":"Fit Statistical Model for Count Data ‚Äî fit_devil","text":"Fits statistical model count data, particularly designed RNA-seq data analysis. function estimates regression coefficients (beta), gene-wise overdispersion parameters, normalizes data using size factors. supports CPU (optionally) GPU-based computation parallel processing capabilities.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/fit_devil.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Fit Statistical Model for Count Data ‚Äî fit_devil","text":"","code":"fit_devil(   input_matrix,   design_matrix,   overdispersion = \"MOM\",   init_overdispersion = NULL,   init_beta_rough = FALSE,   offset = 0,   size_factors = NULL,   verbose = FALSE,   max_iter = 200,   tolerance = 0.001,   CUDA = FALSE,   batch_size = 1024L,   parallel.cores = 1 )"},{"path":"https://caravagnalab.github.io/devil/reference/fit_devil.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Fit Statistical Model for Count Data ‚Äî fit_devil","text":"input_matrix numeric matrix count data (genes √ó samples). Rows represent genes/features, columns represent samples/cells. design_matrix numeric matrix predictor variables (samples √ó predictors). row corresponds sample, column predictor variable. Must nrow(design_matrix) == ncol(input_matrix). overdispersion Character logical. Strategy estimating overdispersion: one \"new\", \"\", \"old\", \"MLE\", \"MOM\", FALSE disable overdispersion fitting (Poisson model). Default: \"MOM\". init_overdispersion Numeric scalar NULL. Initial value overdispersion parameter used starting point iterative procedures. NULL, initial value estimated data via estimate_dispersion(). Recommended value specified: 100. Default: NULL. init_beta_rough Logial. Whether initialize betas rough extremely fast way. Default: FALSE. offset Numeric scalar. Value used computing offset vector avoid numerical issues zero counts. Default: 0. size_factors Character string NULL. Method computing normalization factors account different sequencing depths. Options : NULL (default):  normalization (size factors set 1) \"normed_sum\": Geometric mean normalization \"psinorm\": Psi-normalization \"edgeR\": edgeR TMM method verbose Logical. Whether print progress messages execution. Default: FALSE. max_iter Integer. Maximum number iterations parameter optimization (beta overdispersion routines). Default: 200. tolerance Numeric. Convergence criterion parameter optimization. Default: 1e-3. CUDA Logical. Whether use GPU acceleration (requires CUDA support compiled beta_fit_gpu() implementation). Default: FALSE. batch_size Integer. Number genes process per batch GPU mode. relevant CUDA = TRUE. Default: 1024. parallel.cores Integer NULL. Number CPU cores parallel processing parallel::mclapply. NULL, uses available cores. Default: 1.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/fit_devil.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Fit Statistical Model for Count Data ‚Äî fit_devil","text":"list containing: beta Matrix fitted coefficients (genes √ó predictors). overdispersion Vector fitted overdispersion parameters (one per gene). iterations List elements beta_iters theta_iters giving number iterations used gene. size_factors Vector computed size factors (one per sample). offset_vector Vector offset values used model (length = number samples). design_matrix Input design matrix (provided, possibly coerced numeric matrix). input_matrix Input count matrix (provided, possibly coerced numeric matrix). input_parameters List used parameter values (max_iter, tolerance, parallel.cores).","code":""},{"path":"https://caravagnalab.github.io/devil/reference/fit_devil.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Fit Statistical Model for Count Data ‚Äî fit_devil","text":"function implements negative binomial regression model following steps: Computes size factors data normalization (requested) Initializes model parameters including beta coefficients overdispersion Fits regression coefficients using either CPU (parallel) GPU computation Optionally fits/updates overdispersion parameters using one several strategies model fitting process uses iterative optimization configurable convergence criteria maximum iterations. large datasets, GPU implementation processes genes batches improved memory efficiency.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/fit_devil.html","id":"size-factor-methods","dir":"Reference","previous_headings":"","what":"Size Factor Methods","title":"Fit Statistical Model for Count Data ‚Äî fit_devil","text":"Three normalization methods available size_factors character string: \"normed_sum\" (default): Geometric mean normalization based library sizes. Fast works well datasets. \"psinorm\": Psi-normalization using Pareto distribution MLE. robust highly variable genes. \"edgeR\": edgeR's TMM singleton pairing method. Requires edgeR package Bioconductor. size_factors = NULL, normalization performed size factors set 1.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/fit_devil.html","id":"overdispersion-strategies","dir":"Reference","previous_headings":"","what":"Overdispersion Strategies","title":"Fit Statistical Model for Count Data ‚Äî fit_devil","text":"overdispersion argument controls gene-wise overdispersion handled: \"old\" \"MLE\": Overdispersion fit via original (legacy) NB MLE-based procedure (Cox‚ÄìReid adjustment inside fit_dispersion()). \"new\" \"\": Overdispersion fit via new iterative NB routine implemented fit_overdispersion_cppp(), typically faster stable large single-cell datasets. \"MOM\": Overdispersion estimated using method--moments approach via estimate_mom_dispersion_cpp(), cheap provides rough dispersion estimate. FALSE: Disable overdispersion fitting use Poisson model (overdispersion fixed 0).","code":""},{"path":"https://caravagnalab.github.io/devil/reference/fit_devil.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Fit Statistical Model for Count Data ‚Äî fit_devil","text":"","code":"## Example: fit a simple two-group model set.seed(1)  # Simulate a small counts matrix (genes x cells) counts <- matrix(     rnbinom(1000, mu = 0.2, size = 1),     nrow = 100, ncol = 10 ) rownames(counts) <- paste0(\"gene\", seq_len(nrow(counts)))  # Two-group design (no intercept) group <- factor(rep(c(\"A\", \"B\"), each = 5)) design <- model.matrix(~ 0 + group) colnames(design) <- levels(group)  # Fit the model fit <- fit_devil(     input_matrix  = counts,     design_matrix = design,     size_factors  = \"normed_sum\",     verbose       = TRUE ) #> Compute size factors #> Calculating size factors using method: normed_sum #> Size factors calculated successfully. #> Range: [0.53, 1.4311] #> Initialize theta #> Initialize beta #> Fitting beta coefficients #> Fit overdispersion (mode = MOM)"},{"path":"https://caravagnalab.github.io/devil/reference/fit_dispersion.html","id":null,"dir":"Reference","previous_headings":"","what":"Fit Dispersion Parameter for Negative Binomial Model ‚Äî fit_dispersion","title":"Fit Dispersion Parameter for Negative Binomial Model ‚Äî fit_dispersion","text":"Estimates dispersion parameter negative binomial GLM using maximum likelihood estimation. Implementation glmGamPoi package.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/fit_dispersion.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Fit Dispersion Parameter for Negative Binomial Model ‚Äî fit_dispersion","text":"","code":"fit_dispersion(   beta,   model_matrix,   y,   offset_matrix,   tolerance,   max_iter,   do_cox_reid_adjustment = TRUE )"},{"path":"https://caravagnalab.github.io/devil/reference/fit_dispersion.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Fit Dispersion Parameter for Negative Binomial Model ‚Äî fit_dispersion","text":"beta Vector coefficient estimates model_matrix Design matrix predictor variables y Vector response variables (counts) offset_matrix Matrix offset values tolerance Convergence tolerance optimization max_iter Maximum number iterations optimization do_cox_reid_adjustment Logical indicating whether apply Cox-Reid adjustment","code":""},{"path":"https://caravagnalab.github.io/devil/reference/fit_dispersion.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Fit Dispersion Parameter for Negative Binomial Model ‚Äî fit_dispersion","text":"Estimated dispersion parameter","code":""},{"path":"https://caravagnalab.github.io/devil/reference/fit_dispersion.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Fit Dispersion Parameter for Negative Binomial Model ‚Äî fit_dispersion","text":"implementation comes glmGamPoi package: https://github.com/const-ae/glmGamPoi Original publication: Ahlmann-Eltze, C., Huber, W. (2020). glmGamPoi: Fitting Gamma-Poisson Generalized Linear Models Single Cell Count Data. Bioinformatics. https://doi.org/10.1093/bioinformatics/btaa1009","code":""},{"path":"https://caravagnalab.github.io/devil/reference/init_beta.html","id":null,"dir":"Reference","previous_headings":"","what":"Initialize Beta Coefficients Using Design Matrix ‚Äî init_beta","title":"Initialize Beta Coefficients Using Design Matrix ‚Äî init_beta","text":"Initializes regression coefficients using QR decomposition design matrix normalized log counts.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/init_beta.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Initialize Beta Coefficients Using Design Matrix ‚Äî init_beta","text":"","code":"init_beta(y, design_matrix, offset_matrix)"},{"path":"https://caravagnalab.github.io/devil/reference/init_beta.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Initialize Beta Coefficients Using Design Matrix ‚Äî init_beta","text":"y Count data matrix design_matrix Matrix predictor variables offset_matrix Matrix offset values","code":""},{"path":"https://caravagnalab.github.io/devil/reference/init_beta.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Initialize Beta Coefficients Using Design Matrix ‚Äî init_beta","text":"Matrix initial beta coefficients","code":""},{"path":"https://caravagnalab.github.io/devil/reference/init_beta_groups.html","id":null,"dir":"Reference","previous_headings":"","what":"Initialize Beta Coefficients Using Groups ‚Äî init_beta_groups","title":"Initialize Beta Coefficients Using Groups ‚Äî init_beta_groups","text":"Initializes regression coefficients based group-wise means normalized counts.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/init_beta_groups.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Initialize Beta Coefficients Using Groups ‚Äî init_beta_groups","text":"","code":"init_beta_groups(y, groups, offset_matrix)"},{"path":"https://caravagnalab.github.io/devil/reference/init_beta_groups.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Initialize Beta Coefficients Using Groups ‚Äî init_beta_groups","text":"y Count data matrix groups Vector indicating group membership offset_matrix Matrix offset values","code":""},{"path":"https://caravagnalab.github.io/devil/reference/init_beta_groups.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Initialize Beta Coefficients Using Groups ‚Äî init_beta_groups","text":"Matrix initial beta coefficients group","code":""},{"path":"https://caravagnalab.github.io/devil/reference/normed_sum_sf.html","id":null,"dir":"Reference","previous_headings":"","what":"Geometric Mean Normalization Size Factors ‚Äî normed_sum_sf","title":"Geometric Mean Normalization Size Factors ‚Äî normed_sum_sf","text":"Computes size factors based library sizes (column sums) normalized geometric mean.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/normed_sum_sf.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Geometric Mean Normalization Size Factors ‚Äî normed_sum_sf","text":"","code":"normed_sum_sf(Y)"},{"path":"https://caravagnalab.github.io/devil/reference/normed_sum_sf.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Geometric Mean Normalization Size Factors ‚Äî normed_sum_sf","text":"Y Count data matrix genes rows samples columns","code":""},{"path":"https://caravagnalab.github.io/devil/reference/normed_sum_sf.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Geometric Mean Normalization Size Factors ‚Äî normed_sum_sf","text":"Numeric vector size factors","code":""},{"path":"https://caravagnalab.github.io/devil/reference/plot_volcano.html","id":null,"dir":"Reference","previous_headings":"","what":"Create Volcano Plot for Differential Expression Results ‚Äî plot_volcano","title":"Create Volcano Plot for Differential Expression Results ‚Äî plot_volcano","text":"Generates customizable volcano plot visualizing differential expression results, highlighting significant genes based fold change statistical significance. plot supports various customization options including color schemes, point sizes, gene labeling.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/plot_volcano.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create Volcano Plot for Differential Expression Results ‚Äî plot_volcano","text":"","code":"plot_volcano(   devil.res,   lfc_cut = 1,   pval_cut = 0.05,   labels = TRUE,   colors = c(\"gray\", \"forestgreen\", \"steelblue\", \"indianred\"),   color_alpha = 0.7,   point_size = 1,   center = TRUE,   title = \"Volcano plot\" )"},{"path":"https://caravagnalab.github.io/devil/reference/plot_volcano.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create Volcano Plot for Differential Expression Results ‚Äî plot_volcano","text":"devil.res tibble test_de() containing columns: name: Gene identifiers adj_pval: Adjusted p-values lfc: Log2 fold changes lfc_cut Numeric. Absolute log2 fold change threshold significance. Default: 1 pval_cut Numeric. Adjusted p-value threshold significance. Default: 0.05 labels Logical. Whether label genes meeting significance criteria. Default: TRUE colors Character vector length 4 specifying colors : Non-significant genes Fold-change significant P-value significant significant Default: c(\"gray\", \"forestgreen\", \"steelblue\", \"indianred\") color_alpha Numeric 0 1. Transparency level points. Default: 0.7 point_size Numeric. Size plotting points. Default: 1 center Logical. Whether center x-axis zero. Default: TRUE title Character. Plot title. Default: \"Volcano plot\"","code":""},{"path":"https://caravagnalab.github.io/devil/reference/plot_volcano.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create Volcano Plot for Differential Expression Results ‚Äî plot_volcano","text":"ggplot2 object containing volcano plot.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/plot_volcano.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Create Volcano Plot for Differential Expression Results ‚Äî plot_volcano","text":"function creates scatter plot : X-axis: Log2 fold change Y-axis: -Log10 adjusted p-value Points colored based significance categories: Non-significant: Neither p-value fold change threshold met LFC significant: fold change threshold met P-value significant: p-value threshold met significant: thresholds met plot includes dashed lines indicating significance thresholds optionally labels genes meeting significance criteria.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/plot_volcano.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Create Volcano Plot for Differential Expression Results ‚Äî plot_volcano","text":"Genes adj_pval = 0 assigned smallest non-zero p-value dataset NA values removed warning Gene labels placed overlap prevention","code":""},{"path":"https://caravagnalab.github.io/devil/reference/plot_volcano.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Create Volcano Plot for Differential Expression Results ‚Äî plot_volcano","text":"","code":"set.seed(1) y <- t(as.matrix(rnbinom(1000, 1, .1))) fit <- devil::fit_devil(input_matrix = y, design_matrix = matrix(1, ncol = 1, nrow = 1000)) de_results <- devil::test_de(devil.fit = fit, contrast = c(1))  # Basic volcano plot de_results$name = paste0(\"Fake gene\") plot_volcano(de_results) #> Warning: no non-missing arguments to min; returning Inf #> 1 genes have adjusted p-value equal to 0, will be set to Inf   # Custom thresholds and colors plot_volcano(de_results,     lfc_cut = 2,     pval_cut = 0.01,     colors = c(\"grey80\", \"blue\", \"green\", \"red\") ) #> Warning: no non-missing arguments to min; returning Inf #> 1 genes have adjusted p-value equal to 0, will be set to Inf   # Without gene labels de_results$name <- \"fake gene\" plot_volcano(de_results, labels = FALSE) #> Warning: no non-missing arguments to min; returning Inf #> 1 genes have adjusted p-value equal to 0, will be set to Inf"},{"path":"https://caravagnalab.github.io/devil/reference/psinorm_sf.html","id":null,"dir":"Reference","previous_headings":"","what":"Psi-Normalization Size Factors ‚Äî psinorm_sf","title":"Psi-Normalization Size Factors ‚Äî psinorm_sf","text":"Computes size factors using psi-normalization based Pareto distribution maximum likelihood estimation.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/psinorm_sf.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Psi-Normalization Size Factors ‚Äî psinorm_sf","text":"","code":"psinorm_sf(Y)"},{"path":"https://caravagnalab.github.io/devil/reference/psinorm_sf.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Psi-Normalization Size Factors ‚Äî psinorm_sf","text":"Y Count data matrix genes rows samples columns","code":""},{"path":"https://caravagnalab.github.io/devil/reference/psinorm_sf.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Psi-Normalization Size Factors ‚Äî psinorm_sf","text":"Numeric vector size factors","code":""},{"path":"https://caravagnalab.github.io/devil/reference/test_de.html","id":null,"dir":"Reference","previous_headings":"","what":"Test for Differential Expression ‚Äî test_de","title":"Test for Differential Expression ‚Äî test_de","text":"Performs statistical testing differential expression using results fitted devil model. Supports standard robust (clustered) variance estimation, multiple testing correction customizable fold change thresholds.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/test_de.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Test for Differential Expression ‚Äî test_de","text":"","code":"test_de(   devil.fit,   contrast,   pval_adjust_method = \"BH\",   max_lfc = 10,   clusters = NULL,   parallel.cores = 1 )"},{"path":"https://caravagnalab.github.io/devil/reference/test_de.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Test for Differential Expression ‚Äî test_de","text":"devil.fit fitted model object fit_devil(). Must contain beta coefficients, design matrix, overdispersion parameters. contrast Numeric vector matrix specifying comparison interest. Length must match number coefficients model. example, c(0, 1, -1) tests difference second third coefficient. pval_adjust_method Character. Method p-value adjustment. Passed stats::p.adjust(). Common choices: \"BH\": Benjamini-Hochberg (default) \"bonferroni\": Bonferroni correction \"holm\": Holm's step-method max_lfc Numeric. Maximum absolute log2 fold change report. Larger values capped ¬±max_lfc. Default: 10 clusters Numeric vector factor. Sample cluster assignments robust variance estimation. Length must match number samples. Default: NULL parallel.cores Integer NULL. Number CPU cores parallel processing. NULL, uses available cores. Default: 1","code":""},{"path":"https://caravagnalab.github.io/devil/reference/test_de.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Test for Differential Expression ‚Äî test_de","text":"tibble columns: name Character. Gene identifiers input data pval Numeric. Raw p-values statistical tests adj_pval Numeric. Adjusted p-values multiple testing correction lfc Numeric. Log2 fold changes, capped ¬±max_lfc","code":""},{"path":"https://caravagnalab.github.io/devil/reference/test_de.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Test for Differential Expression ‚Äî test_de","text":"function implements following analysis pipeline: Calculates log fold changes using contrast vectors/matrices Computes test statistics using either standard robust variance estimation Calculates p-values using t-distribution appropriate degrees freedom Adjusts p-values multiple testing Applies fold change thresholding variance estimation can account sample clustering (e.g., multiple samples patient) using sandwich estimator robust inference.","code":""},{"path":"https://caravagnalab.github.io/devil/reference/test_de.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Test for Differential Expression ‚Äî test_de","text":"","code":"## Example: test_de() on a simple two-group comparison set.seed(1)  # Simulate counts (genes x cells) counts <- matrix(rnbinom(1000, mu = 0.2, size = 1), nrow = 100, ncol = 10) rownames(counts) <- paste0(\"gene\", seq_len(nrow(counts)))  # Two-group design (no intercept) group <- factor(rep(c(\"A\", \"B\"), each = 5)) design <- model.matrix(~ 0 + group) colnames(design) <- levels(group)  # Fit model fit <- fit_devil(     input_matrix  = counts,     design_matrix = design,     size_factors  = \"normed_sum\" )  # Test A vs B (contrast = +1*A -1*B) res <- test_de(     fit,     contrast = c(A = 1, B = -1) ) head(res[order(res$adj_pval), ]) #> # A tibble: 6 √ó 4 #>   name        pval adj_pval    lfc #>   <chr>      <dbl>    <dbl>  <dbl> #> 1 gene4  0.0000194  0.00125  -8.97 #> 2 gene86 0.0000251  0.00125   8.74 #> 3 gene63 0.0000488  0.00139   7.20 #> 4 gene70 0.0000621  0.00139 -10    #> 5 gene75 0.0000696  0.00139   8.46 #> 6 gene18 0.0000850  0.00142   8.53  ## Example: clustered (patient-aware) variance (sandwich SE)  patient <- factor(rep(c(\"P1\", \"P2\"), each = 5))  res_clustered <- test_de(     fit,     contrast = c(A = 1, B = -1),     clusters = patient ) #> Converting clusters to numeric factors  head(res_clustered[order(res_clustered$adj_pval), ]) #> # A tibble: 6 √ó 4 #>   name       pval adj_pval    lfc #>   <chr>     <dbl>    <dbl>  <dbl> #> 1 gene1  0.00179    0.0336   9.37 #> 2 gene4  0.00232    0.0336  -8.97 #> 3 gene18 0.00325    0.0336   8.53 #> 4 gene57 0.00161    0.0336  -9.54 #> 5 gene65 0.00155    0.0336   9.60 #> 6 gene70 0.000731   0.0336 -10"}]
