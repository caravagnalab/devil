<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit Statistical Model for Count Data — fit_devil • devil</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit Statistical Model for Count Data — fit_devil"><meta name="description" content="Fits a statistical model to count data, particularly designed for RNA sequencing data analysis.
The function estimates multiple parameters including regression coefficients (beta),
overdispersion parameters, and normalizes data using size factors. It supports both CPU
and GPU-based computation with parallel processing capabilities."><meta property="og:description" content="Fits a statistical model to count data, particularly designed for RNA sequencing data analysis.
The function estimates multiple parameters including regression coefficients (beta),
overdispersion parameters, and normalizes data using size factors. It supports both CPU
and GPU-based computation with parallel processing capabilities."><meta property="og:image" content="https://caravagnalab.github.io/devil/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">devil</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/getStarted.html">Get started</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/caravagnalab/devil/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Fit Statistical Model for Count Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/caravagnalab/devil/R/main.R" class="external-link"><code>R/main.R</code></a></small>
      <div class="d-none name"><code>fit_devil.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits a statistical model to count data, particularly designed for RNA sequencing data analysis.
The function estimates multiple parameters including regression coefficients (beta),
overdispersion parameters, and normalizes data using size factors. It supports both CPU
and GPU-based computation with parallel processing capabilities.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fit_devil</span><span class="op">(</span></span>
<span>  <span class="va">input_matrix</span>,</span>
<span>  <span class="va">design_matrix</span>,</span>
<span>  overdispersion <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  init_overdispersion <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  do_cox_reid_adjustment <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  offset <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  size_factors <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  CUDA <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">1024L</span>,</span>
<span>  parallel.cores <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-input-matrix">input_matrix<a class="anchor" aria-label="anchor" href="#arg-input-matrix"></a></dt>
<dd><p>A numeric matrix of count data (genes × samples).
Rows represent genes/features, columns represent samples/cells.</p></dd>


<dt id="arg-design-matrix">design_matrix<a class="anchor" aria-label="anchor" href="#arg-design-matrix"></a></dt>
<dd><p>A numeric matrix of predictor variables (samples × predictors).
Each row corresponds to a sample, each column to a predictor variable.</p></dd>


<dt id="arg-overdispersion">overdispersion<a class="anchor" aria-label="anchor" href="#arg-overdispersion"></a></dt>
<dd><p>Logical. Whether to estimate the overdispersion parameter.
Set to FALSE for Poisson regression. Default: TRUE</p></dd>


<dt id="arg-init-overdispersion">init_overdispersion<a class="anchor" aria-label="anchor" href="#arg-init-overdispersion"></a></dt>
<dd><p>Numeric or NULL. Initial value for overdispersion parameter.
If NULL, estimates initial value from data. Recommended value if specified: 100.
Default: NULL</p></dd>


<dt id="arg-do-cox-reid-adjustment">do_cox_reid_adjustment<a class="anchor" aria-label="anchor" href="#arg-do-cox-reid-adjustment"></a></dt>
<dd><p>Logical. Whether to apply Cox-Reid adjustment in
overdispersion estimation. Default: TRUE</p></dd>


<dt id="arg-offset">offset<a class="anchor" aria-label="anchor" href="#arg-offset"></a></dt>
<dd><p>Numeric. Value added to counts to avoid numerical issues with zero counts.
Default: 1e-6</p></dd>


<dt id="arg-size-factors">size_factors<a class="anchor" aria-label="anchor" href="#arg-size-factors"></a></dt>
<dd><p>Logical. Whether to compute normalization factors for different
sequencing depths. Default: TRUE</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. Whether to print progress messages during execution.
Default: FALSE</p></dd>


<dt id="arg-max-iter">max_iter<a class="anchor" aria-label="anchor" href="#arg-max-iter"></a></dt>
<dd><p>Integer. Maximum number of iterations for parameter optimization.
Default: 100</p></dd>


<dt id="arg-tolerance">tolerance<a class="anchor" aria-label="anchor" href="#arg-tolerance"></a></dt>
<dd><p>Numeric. Convergence criterion for parameter optimization.
Default: 1e-3</p></dd>


<dt id="arg-cuda">CUDA<a class="anchor" aria-label="anchor" href="#arg-cuda"></a></dt>
<dd><p>Logical. Whether to use GPU acceleration (requires CUDA support).
Default: FALSE</p></dd>


<dt id="arg-batch-size">batch_size<a class="anchor" aria-label="anchor" href="#arg-batch-size"></a></dt>
<dd><p>Integer. Number of genes to process per batch in GPU mode.
Only relevant if CUDA = TRUE. Default: 1024</p></dd>


<dt id="arg-parallel-cores">parallel.cores<a class="anchor" aria-label="anchor" href="#arg-parallel-cores"></a></dt>
<dd><p>Integer or NULL. Number of CPU cores for parallel processing.
If NULL, uses all available cores. Default: NULL</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing:</p><dl><dt>beta</dt>
<dd><p>Matrix of fitted coefficients (genes × predictors)</p></dd>

<dt>overdispersion</dt>
<dd><p>Vector of fitted overdispersion parameters (one per gene)</p></dd>

<dt>iterations</dt>
<dd><p>Vector of iteration counts for convergence (one per gene)</p></dd>

<dt>size_factors</dt>
<dd><p>Vector of computed size factors (one per sample)</p></dd>

<dt>offset_vector</dt>
<dd><p>Vector of offset values used in the model</p></dd>

<dt>design_matrix</dt>
<dd><p>Input design matrix (as provided)</p></dd>

<dt>input_matrix</dt>
<dd><p>Input count matrix (as provided)</p></dd>

<dt>input_parameters</dt>
<dd><p>List of used parameter values (max_iter, tolerance, parallel.cores)</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function implements a negative binomial regression model with the following steps:</p><ol><li><p>Computes size factors for data normalization (if requested)</p></li>
<li><p>Initializes model parameters including beta coefficients and overdispersion</p></li>
<li><p>Fits the model using either CPU (parallel) or GPU computation</p></li>
<li><p>Optionally estimates overdispersion parameters</p></li>
</ol><p>The model fitting process uses iterative optimization with configurable convergence
criteria and maximum iterations. For large datasets, the GPU implementation processes
genes in batches for improved memory efficiency.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Basic usage with default parameters</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">fit_devil</span><span class="op">(</span><span class="va">counts</span>, <span class="va">design</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using GPU acceleration with custom batch size</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">fit_devil</span><span class="op">(</span><span class="va">counts</span>, <span class="va">design</span>, CUDA <span class="op">=</span> <span class="cn">TRUE</span>, batch_size <span class="op">=</span> <span class="fl">2048</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Disable overdispersion estimation (Poisson model)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">fit_devil</span><span class="op">(</span><span class="va">counts</span>, <span class="va">design</span>, overdispersion <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Giovanni Santacatterina.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

