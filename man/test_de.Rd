% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/test.R
\name{test_de}
\alias{test_de}
\title{Test for Differential Expression}
\usage{
test_de(
  devil.fit,
  contrast,
  pval_adjust_method = "BH",
  max_lfc = 10,
  clusters = NULL,
  parallel.cores = NULL
)
}
\arguments{
\item{devil.fit}{A fitted model object from fit_devil().
Must contain beta coefficients, design matrix, and overdispersion parameters.}

\item{contrast}{Numeric vector or matrix specifying the comparison of interest.
Length must match number of coefficients in the model.
For example, c(0, 1, -1) tests difference between second and third coefficient.}

\item{pval_adjust_method}{Character. Method for p-value adjustment.
Passed to stats::p.adjust(). Common choices:
\itemize{
\item "BH": Benjamini-Hochberg (default)
\item "bonferroni": Bonferroni correction
\item "holm": Holm's step-down method
}}

\item{max_lfc}{Numeric. Maximum absolute log2 fold change to report.
Larger values are capped at ±max_lfc. Default: 10}

\item{clusters}{Numeric vector or factor. Sample cluster assignments for robust
variance estimation. Length must match number of samples. Default: NULL}

\item{parallel.cores}{Integer or NULL. Number of CPU cores for parallel processing.
If NULL, uses all available cores. Default: NULL}
}
\value{
A tibble with columns:
\describe{
\item{name}{Character. Gene identifiers from input data}
\item{pval}{Numeric. Raw p-values from statistical tests}
\item{adj_pval}{Numeric. Adjusted p-values after multiple testing correction}
\item{lfc}{Numeric. Log2 fold changes, capped at ±max_lfc}
}
}
\description{
Performs statistical testing for differential expression using results from a fitted
devil model. Supports both standard and robust (clustered) variance estimation,
with multiple testing correction and customizable fold change thresholds.
}
\details{
The function implements the following analysis pipeline:
\enumerate{
\item Calculates log fold changes using contrast vectors/matrices
\item Computes test statistics using either standard or robust variance estimation
\item Calculates p-values using t-distribution with appropriate degrees of freedom
\item Adjusts p-values for multiple testing
\item Applies fold change thresholding
}

The variance estimation can account for sample clustering (e.g., multiple samples
from the same patient) using a sandwich estimator for robust inference.
}
\examples{
\dontrun{
# Basic differential expression test
results <- test_de(fit, contrast = c(0, 1, -1))

# With sample clustering and stricter fold change threshold
results <- test_de(fit, contrast = c(0, 1, -1),
                   clusters = patient_ids,
                   max_lfc = 5)
}

}
