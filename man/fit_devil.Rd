% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/main.R
\name{fit_devil}
\alias{fit_devil}
\title{Fit Statistical Model for Count Data}
\usage{
fit_devil(
  input_matrix,
  design_matrix,
  overdispersion = TRUE,
  init_overdispersion = NULL,
  do_cox_reid_adjustment = TRUE,
  offset = 1e-06,
  size_factors = TRUE,
  verbose = FALSE,
  max_iter = 100,
  tolerance = 0.001,
  CUDA = FALSE,
  batch_size = 1024L,
  parallel.cores = NULL
)
}
\arguments{
\item{input_matrix}{A numeric matrix of count data (genes × samples).
Rows represent genes/features, columns represent samples/cells.}

\item{design_matrix}{A numeric matrix of predictor variables (samples × predictors).
Each row corresponds to a sample, each column to a predictor variable.}

\item{overdispersion}{Logical. Whether to estimate the overdispersion parameter.
Set to FALSE for Poisson regression. Default: TRUE}

\item{init_overdispersion}{Numeric or NULL. Initial value for overdispersion parameter.
If NULL, estimates initial value from data. Recommended value if specified: 100.
Default: NULL}

\item{do_cox_reid_adjustment}{Logical. Whether to apply Cox-Reid adjustment in
overdispersion estimation. Default: TRUE}

\item{offset}{Numeric. Value added to counts to avoid numerical issues with zero counts.
Default: 1e-6}

\item{size_factors}{Logical. Whether to compute normalization factors for different
sequencing depths. Default: TRUE}

\item{verbose}{Logical. Whether to print progress messages during execution.
Default: FALSE}

\item{max_iter}{Integer. Maximum number of iterations for parameter optimization.
Default: 100}

\item{tolerance}{Numeric. Convergence criterion for parameter optimization.
Default: 1e-3}

\item{CUDA}{Logical. Whether to use GPU acceleration (requires CUDA support).
Default: FALSE}

\item{batch_size}{Integer. Number of genes to process per batch in GPU mode.
Only relevant if CUDA = TRUE. Default: 1024}

\item{parallel.cores}{Integer or NULL. Number of CPU cores for parallel processing.
If NULL, uses all available cores. Default: NULL}
}
\value{
A list containing:
\describe{
\item{beta}{Matrix of fitted coefficients (genes × predictors)}
\item{overdispersion}{Vector of fitted overdispersion parameters (one per gene)}
\item{iterations}{Vector of iteration counts for convergence (one per gene)}
\item{size_factors}{Vector of computed size factors (one per sample)}
\item{offset_vector}{Vector of offset values used in the model}
\item{design_matrix}{Input design matrix (as provided)}
\item{input_matrix}{Input count matrix (as provided)}
\item{input_parameters}{List of used parameter values (max_iter, tolerance, parallel.cores)}
}
}
\description{
Fits a statistical model to count data, particularly designed for RNA sequencing data analysis.
The function estimates multiple parameters including regression coefficients (beta),
overdispersion parameters, and normalizes data using size factors. It supports both CPU
and GPU-based computation with parallel processing capabilities.
}
\details{
The function implements a negative binomial regression model with the following steps:
\enumerate{
\item Computes size factors for data normalization (if requested)
\item Initializes model parameters including beta coefficients and overdispersion
\item Fits the model using either CPU (parallel) or GPU computation
\item Optionally estimates overdispersion parameters
}

The model fitting process uses iterative optimization with configurable convergence
criteria and maximum iterations. For large datasets, the GPU implementation processes
genes in batches for improved memory efficiency.
}
\examples{
\dontrun{
# Basic usage with default parameters
fit <- fit_devil(counts, design)

# Using GPU acceleration with custom batch size
fit <- fit_devil(counts, design, CUDA = TRUE, batch_size = 2048)

# Disable overdispersion estimation (Poisson model)
fit <- fit_devil(counts, design, overdispersion = FALSE)
}

}
